<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>AI Planner â€“ Daily Check-in & State Result</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,600,700&display=swap">
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
  <style>
    /* --- All the CSS as in your prior checkin.html and state-result.html --- */
    :root {
      --iphone-width: 390px;
      --iphone-height: 852px;
      --gradient-bg: linear-gradient(137deg, #1a1f4d 0%, #252a5d 100%);
      --card-bg: rgba(45,53,88,0.95);
      --glass-card-bg: rgba(45,53,88,0.60);
      --card-border: rgba(255,255,255,0.10);
      --accent-yellow: #f4e87c;
      --accent-orange: #ff9f43;
      --accent-coral: #ffb4a8;
      --accent-pink: #ff9aa2;
      --accent-blue: #89cff0;
      --accent-cyan: #6ec6e6;
      --accent-purple: #a89ef0;
      --progress-gray: rgba(74,79,107,0.4);
      --dark-gray: #3a3f5a;
      --text-primary: #fff;
      --text-secondary: #b8bcc9;
      --text-on-yellow: #1a1f4d;
      --glass-radius: 16px;
      --btn-radius: 28px;
      --btn-height: 56px;
      --font-title: 24px;image.png
      --font-question: 18px;
      --font-label: 14px;
      --font-btn: 16px;
      --font-value: 14px;
      --font-answer-label: 11px;
      --font-cardind: 12px;
      --font-overline: 12px;
      --transition: cubic-bezier(.22,1,.36,1);
      --shadow-card: 0 4px 12px rgba(0,0,0,0.15);
      --shadow-btn: 0 4px 12px rgba(244,232,124,0.3);
      --shadow-btn-active: 0 6px 16px rgba(244,232,124,0.40);
      --gray: #4a4f6b;
    }
    html {
      background: #f5f5f5;
      height: 100%;
      min-height: 100%;
      scroll-behavior: smooth;
    }
    body {
      min-height: 100vh;
      background: #f5f5f5;
      margin: 0;
      padding: 24px 0;
      color: var(--text-primary);
      font-family: 'Inter', 'SF Pro Display', Arial, sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      position: relative;
      overflow-x: hidden;
      overflow-y: auto;
      box-sizing: border-box;
    }
    .device-frame {
      width: 390px;
      height: 844px;
      border-radius: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.12), 0 0 0 1px rgba(0,0,0,0.08);
      margin: 0 auto;
      overflow: hidden;
      background: var(--gradient-bg);
      position: relative;
      display: flex;
      flex-direction: column;
    }
    .ios-status-bar {
      width: 100%;
      max-width: 390px;
      height: 54px;
      background: transparent;
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      padding: 8px 20px 0;
      position: relative;
      z-index: 200;
      flex-shrink: 0;
      margin: 0 auto;
      box-sizing: border-box;
    }
    .dynamic-island {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 126px;
      height: 37px;
      background: #000;
      border-radius: 0 0 20px 20px;
      z-index: 201;
    }
    .status-left {
      position: absolute;
      left: 20px;
      top: 16px;
      font-size: 15px;
      font-weight: 600;
      color: #fff;
      letter-spacing: -0.3px;
    }
    .status-right {
      position: absolute;
      right: 20px;
      top: 16px;
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 15px;
      font-weight: 600;
      color: #fff;
    }
    .status-icons {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .app-header {
      width: 100%;
      max-width: 390px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      position: relative;
      flex-shrink: 0;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      margin-bottom: 20px;
      box-sizing: border-box;
    }
    .app-header h1 {
      font-size: 17px;
      font-weight: 600;
      color: #fff;
      margin: 0;
      letter-spacing: -0.4px;
    }
    .safe-area {
      flex: 1;
      position: relative;
      overflow-y: auto;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
      padding-left: 16px;
      padding-right: 16px;
      padding-bottom: 24px;
      -ms-overflow-style: none;
      scrollbar-width: none;
      scroll-behavior: smooth;
    }
    .safe-area::-webkit-scrollbar {
      display: none;
    }
    #router-ctn {
      display: flex;
      flex-direction: column;
      min-height: 0;
      padding-bottom: 40px;
    }
    /* --- CHECK-IN STYLES --- */
    .header {
      min-height: 80px;
      height: 80px;
      display: flex;
      align-items: flex-end;
      background: transparent;
      margin-top: 0;
      margin-bottom: 8px;
      position: relative;
      justify-content: center;
      width: 100%;
      flex-shrink: 0;
    }
    .header .back-btn {
      position: absolute;
      left: 0; bottom: 12px;
      width: 44px; height: 44px;
      min-width: 44px; min-height: 44px;
      background: none; border: none;
      color: var(--text-secondary);
      font-size: 24px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      border-radius: 50%;
      outline: none;
      z-index: 10;
    }
    .header .back-btn:active { color: #f4e87c; background: rgba(244,232,124,0.07); }
    .title {
      color: var(--text-primary);
      font-size: var(--font-title);
      font-weight: 600;
      letter-spacing: 0.5px;
      text-align: center;
      width: 100%;
      margin-bottom: 3px;
    }
    .header-row {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      width: 100%;
      margin-bottom: 20px;
      padding: 0;
    }
    .progress {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 32px;
      z-index: 2;
    }
    .prog-dot, .prog-dot.past, .prog-dot.current, .prog-dot.skip {
      width: 8px; height: 8px;
      min-width: 8px; min-height: 8px;
      border-radius: 50%;
      margin: 0 6px;
      background: var(--progress-gray);
      display: flex; align-items: center; justify-content: center;
      position: relative;
      transition: background 0.18s, box-shadow 0.18s, transform 0.18s;
    }
    .prog-dot.current {
      background: var(--accent-yellow);
      box-shadow: 0 0 8px 3px #f4e87c88;
      transform: scale(1.2);
      animation: growDot 0.20s;
    }
    .prog-dot.past {
      background: var(--accent-yellow);
    }
    .prog-dot.past:after {
      content: '\2713';
      font-size: 7px;
      color: #252a5d;
      position: absolute;
      left: 1px; top: -1px;
      font-weight: 700;
    }
    .prog-dot.skip {
      background: var(--progress-gray);
    }
    .prog-dot.skip:after {
      content: '\23ed';
      font-size: 7px;
      color: #ffd54f;
      position: absolute;
      left: 1px; top: -2px;
      font-weight: 700;
    }
    @keyframes growDot {
      0% { transform: scale(0.8); box-shadow: none; }
      100% { transform: scale(1.2); box-shadow: 0 0 10px var(--accent-yellow, #f4e87c77); }
    }
    .card-slide-ctn {
      position: relative;
      overflow: visible;
      margin-bottom: 0;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      width: 100%;
      flex-shrink: 0;
    }
    .glass-card {
      width: 100%;
      max-width: 358px;
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: var(--shadow-card);
      border: 1px solid var(--card-border);
      padding: 24px;
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      position: relative;
      transition: transform 0.22s var(--transition), opacity 0.21s var(--transition);
      opacity: 1;
      box-sizing: border-box;
    }
    .glass-card.next { transform: translateX(60%); opacity: 0; z-index: 1; pointer-events: none; }
    .glass-card.prev { transform: translateX(-60%); opacity: 0; z-index: 1; pointer-events: none; }
    .glass-card.active { transform: translateX(0px); opacity: 1; z-index: 10; }
    .glass-card.leaving { transition: transform 0.13s var(--transition), opacity 0.13s var(--transition); }
    .glass-card.entering { transition: transform 0.22s var(--transition), opacity 0.22s var(--transition); }
    .glass-card.final {
      min-height: 300px;
      justify-content: center;
      align-items: center;
      text-align: center;
      background: linear-gradient(120deg, #f4e87c22, #2d3558EE 70%);
    }
    .card-indicator {
      text-transform: uppercase;
      font-size: var(--font-cardind);
      letter-spacing: 1.2px;
      color: var(--text-secondary);
      font-weight: 600;
      margin-bottom: 8px;
    }
    .question-txt {
      font-size: var(--font-question);
      color: var(--text-primary);
      font-weight: 500;
      margin-bottom: 8px;
      line-height: 1.4;
      text-align: left;
    }
    .subtext-txt {
      font-size: var(--font-label);
      color: var(--text-secondary);
      margin-bottom: 24px;
      line-height: 1.2;
      min-height: 14px;
      text-align: left;
    }
    .emoji-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      margin-top: 36px;
      margin-bottom: 20px;
      width: 100%;
      position: relative;
    }
    .scale-bar {
      position: absolute;
      top:28px; left:0; right:0;
      height: 2px;
      width: 100%;
      z-index: 0;
      background: repeating-linear-gradient(90deg, rgba(200,200,200,0.1) 0 6px, transparent 6px 18px);
    }
    .scale-gradient {
      position: absolute; top:28px; left:0; right:0;
      height: 2px; width: 100%; border-radius: 2px;
      background: linear-gradient(90deg,#ff6961,#f4e87c 50%,#b8f755 100%);
      opacity: 0.65;
      z-index: 1;
    }
    .emoji-btn {
      background: none;
      border: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      outline: none;
      cursor: pointer;
      padding: 0;
      margin: 0 3px;
      transition: opacity 0.16s, transform 0.19s;
      opacity: 0.6;
      width: 56px;
      height: 56px;
      border-radius: 28px;
      position: relative;
      z-index: 2;
    }
    .emoji-btn.selected,
    .emoji-btn:focus,
    .emoji-btn:active,
    .emoji-btn:hover {
      opacity: 1;
      transform: scale(1.15);
      box-shadow: 0 0 0 5px #f4e87c77, 0 4px 12px rgba(244,232,124,0.13);
      background: rgba(244,232,124,0.08);
    }
    .emoji-icn {
      font-size: 44px;
      margin-top: 0;
      transition: transform 0.15s;
      pointer-events: none;
    }
    .emoji-label {
      font-size: var(--font-answer-label);
      color: var(--text-secondary);
      font-weight: 400;
      margin-top: 8px;
      text-align: center;
      width: 60px;
      margin-left: -2px;
      letter-spacing: 0.1px;
      user-select: none;
    }
    .binary-choices {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 32px;
      width: 100%;
    }
    .choice-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
      min-height: 140px;
      padding: 16px 12px;
      border-radius: 8px;
      text-align: center;
      background: #252a5d;
      border: 2px solid transparent;
      box-shadow: 0 2px 4px rgba(0,0,0, 0.1);
      transition: border 0.18s, background 0.15s, box-shadow 0.16s, opacity .15s;
      cursor: pointer;
      opacity: 0.85;
      position: relative;
      box-sizing: border-box;
    }
    .choice-card.selected {
      border: 2px solid var(--choice-color, #ffb4a8);
      background: linear-gradient(100deg, var(--choice-color, #ffb4a8)22%, transparent 120%);
      box-shadow: 0 0 18px 3px var(--choice-color-weak, #ffb4a829);
      opacity: 1;
    }
    .choice-card.selected:after {
      content: '\2713';
      position: absolute;
      top: 8px; right: 8px;
      width: 22px; height: 22px;
      background: #fff;
      color: var(--choice-color, #ffb4a8);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 14px;
      font-weight: bold;
      box-shadow: 0 1px 3px #0009;
      z-index: 5;
      border: 2px solid #fff;
    }
    .choice-card:not(.selected):hover, .choice-card:not(.selected):active {
      opacity: 1;
      background: #2d3558;
      border: 2px solid rgba(255,255,255,0.1);
    }
    .choice-card:not(.selected) { transition: opacity 0.16s, border 0.1s; }
    .choice-card.faded { opacity: 0.5; }
    .choice-card .choice-icon {
      width: 56px; height: 56px;
      background: var(--choice-color-weak, #ffb4a814);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 12px;
      font-size: 38px;
      color: var(--choice-color, #ffb4a8);
      flex-shrink: 0;
    }
    .choice-card .choice-content { display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .choice-label {
      color: #fff;
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .choice-desc {
      color: #b8bcc9;
      font-size: 13px;
      font-weight: 400;
      line-height: 1.4;
      text-align: center;
    }
    .slider-ctn {
      width: 100%;
      margin-top: 56px;
      margin-bottom: 18px;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }
    .energy-slider {
      width: calc(100% - 48px);
      max-width: 300px;
      height: 6px;
      border-radius: 3px;
      background: #3a3f5a;
      position: relative;
      margin: 0 auto;
      box-shadow: 0 1px 2px rgba(0,0,0,0.2) inset;
      overflow: visible;
      z-index: 2;
    }
    .slider-fill {
      height: 6px;
      border-radius: 3px;
      position: absolute;
      left: 0; top: 0;
      background: linear-gradient(90deg,#f4e87c,#ffb366 120%);
      pointer-events: none;
      transition: width 0.09s cubic-bezier(.18,.72,.42,1);
    }
    .slider-ticks { position:absolute; left:0;top:0;right:0;height:20px;z-index:3; pointer-events: none; }
    .slider-tick {
      position: absolute;
      width: 2px; height: 8px;
      background: var(--progress-gray);
      border-radius: 2px;
      top: -7px;
    }
    .slider-thumb {
      width: 32px; height: 32px;
      border-radius: 50%;
      background: linear-gradient(180deg,#fff 75%,#ede9c1 100%);
      border: 2px solid #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
      position: absolute;
      left: 0; top: 50%;
      transform: translate(-16px,-50%) scale(1);
      cursor: grab;
      transition: box-shadow 0.17s, background 0.17s, border 0.14s, transform .16s;
      z-index: 5;
      display: flex; align-items: center; justify-content: center;
    }
    .slider-thumb:active {
      box-shadow: 0 4px 10px rgba(0,0,0,0.34);
      background: linear-gradient(180deg,#fff 60%,#f9f6eb 100%);
      border-width: 2px;
      transform: translate(-16px,-50%) scale(1.12);
    }
    .slider-value-badge {
      position: absolute;
      left: 50%;
      top: -36px;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.80);
      color: #1a1f4d;
      border-radius: 12px;
      min-width: 40px;
      height: 24px;
      font-size: 14px;
      font-weight: 600;
      display: flex; align-items: center; justify-content: center;
      pointer-events: none;
      transition: opacity 0.18s, top 0.22s;
      opacity: 0;
      z-index: 20;
      padding: 0 8px;
      box-sizing: border-box;
    }
    .slider-value-badge.visible {
      opacity: 1;
      top: -38px;
    }
    .slider-labels {
      width: calc(100% - 48px);
      max-width: 300px;
      display: flex;
      justify-content: space-between;
      padding-top: 6px;
      font-size: 11px;
      color: #b8bcc9;
      font-weight: 400;
      user-select: none;
      margin-bottom: 0;
      letter-spacing: .1px;
    }
    /* Hero Illustration Styles */
    /* Question Motion Header - Vibrant Organic SVG Animations */
    .question-motion-header {
      width: 100%;
      max-width: 120px;
      height: 90px;
      margin: 24px auto 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      opacity: 0;
      transform: scale(0.9);
      transition: opacity 0.6s ease-out, transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
      /* Vibrant brand color palette */
      --brand-yellow: #f4e87c;
      --brand-gold: #ffd54f;
      --brand-orange: #fbbf24;
      --brand-pink: #ffb4a8;
      --brand-coral: #ff9aa2;
      --brand-purple: #764ba2;
      --brand-blue: #89cff0;
      --brand-cyan: #a0e7ff;
      --brand-green: #b5e7a0;
    }
    .question-motion-header.active {
      opacity: 1;
      transform: scale(1);
    }
    .question-motion-header[data-paused="true"] * {
      animation-play-state: paused !important;
    }
    .question-motion-header svg {
      width: 100%;
      height: 100%;
      overflow: visible;
      filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.15));
    }
    
    /* Energy/Sun Animation - Organic pulsing glow */
    @keyframes energyGlow {
      0%, 100% { 
        transform: scale(1); 
        opacity: 0.95;
      }
      33% { 
        transform: scale(1.15); 
        opacity: 1;
      }
      66% { 
        transform: scale(0.95); 
        opacity: 0.9;
      }
    }
    @keyframes energyRays {
      0%, 100% { 
        transform: rotate(0deg) scale(1); 
        opacity: 0.8;
      }
      50% { 
        transform: rotate(180deg) scale(1.1); 
        opacity: 0.6;
      }
    }
    @keyframes energySpark {
      0%, 100% { 
        transform: scale(0) translateY(0); 
        opacity: 0;
      }
      40% { 
        transform: scale(1) translateY(-3px); 
        opacity: 0.9;
      }
      80% { 
        transform: scale(0.7) translateY(-6px); 
        opacity: 0;
      }
    }
    .motion-energy-core {
      animation: energyGlow 3s ease-in-out infinite;
      transform-origin: center;
    }
    .motion-energy-rays {
      animation: energyRays 8s ease-in-out infinite;
      transform-origin: center;
    }
    .motion-energy-spark {
      animation: energySpark 2.5s ease-in-out infinite;
      transform-origin: center;
    }
    
    /* Mood/Wave Animation - Organic flowing curves */
    @keyframes moodFlow {
      0%, 100% { 
        transform: translateX(0) translateY(0); 
        opacity: 0.85;
      }
      50% { 
        transform: translateX(-20px) translateY(-2px); 
        opacity: 1;
      }
    }
    @keyframes moodShift {
      0%, 100% { 
        d: path("M-40 50 Q-20 35, 0 50 T40 50 T80 50 T120 50"); 
      }
      50% { 
        d: path("M-40 50 Q-20 45, 0 50 T40 50 T80 50 T120 50"); 
      }
    }
    .motion-mood-wave {
      animation: moodFlow 4s ease-in-out infinite;
    }
    
    /* Focus/Lens Animation - Converging ripples */
    @keyframes focusConverge {
      0% { 
        transform: scale(1.5); 
        opacity: 0; 
      }
      30% { 
        opacity: 0.8; 
      }
      100% { 
        transform: scale(0.5); 
        opacity: 0; 
      }
    }
    @keyframes focusCenter {
      0%, 100% { 
        transform: scale(1); 
        opacity: 1; 
      }
      50% { 
        transform: scale(1.2); 
        opacity: 0.8; 
      }
    }
    .motion-focus-ring {
      animation: focusConverge 3s ease-in-out infinite;
      transform-origin: center;
    }
    .motion-focus-center {
      animation: focusCenter 3s ease-in-out infinite;
      transform-origin: center;
    }
    
    /* Load/Stack Animation - Organic weight shifting */
    @keyframes loadPress {
      0%, 100% { 
        transform: translateY(0) scaleY(1); 
        opacity: 0.9; 
      }
      30% { 
        transform: translateY(-2px) scaleY(1.05); 
        opacity: 1; 
      }
      60% { 
        transform: translateY(2px) scaleY(0.95); 
        opacity: 0.85; 
      }
    }
    .motion-load-box {
      animation: loadPress 3s ease-in-out infinite;
      transform-origin: center bottom;
    }
    
    /* Motivation/Rocket Animation - Organic launch motion */
    @keyframes motivationLift {
      0%, 100% { 
        transform: translateY(0) rotate(-2deg) scale(1); 
        opacity: 1; 
      }
      40% { 
        transform: translateY(-12px) rotate(2deg) scale(1.05); 
        opacity: 1; 
      }
      60% { 
        transform: translateY(-8px) rotate(-1deg) scale(1.02); 
        opacity: 0.95; 
      }
    }
    @keyframes motivationTrail {
      0% { 
        transform: scale(0.6) translateY(0); 
        opacity: 0; 
      }
      40% { 
        opacity: 0.8; 
      }
      100% { 
        transform: scale(1.4) translateY(15px); 
        opacity: 0; 
      }
    }
    .motion-motivation-body {
      animation: motivationLift 3.5s ease-in-out infinite;
      transform-origin: center center;
    }
    .motion-motivation-trail {
      animation: motivationTrail 1.5s ease-out infinite;
      transform-origin: center;
    }
    
    /* Hourglass Animation - Time pressure */
    @keyframes hourglassRock {
      0%, 100% { 
        transform: rotate(0deg); 
        opacity: 1; 
      }
      25% { 
        transform: rotate(2deg); 
        opacity: 0.95; 
      }
      75% { 
        transform: rotate(-2deg); 
        opacity: 0.95; 
      }
    }
    @keyframes sandDeplete {
      0% { 
        transform: scaleY(1); 
        opacity: 0.85; 
      }
      100% { 
        transform: scaleY(0.4); 
        opacity: 0.6; 
      }
    }
    @keyframes sandFall {
      0% { 
        transform: translateY(-8px); 
        opacity: 0; 
      }
      20% { 
        opacity: 1; 
      }
      80% { 
        opacity: 1; 
      }
      100% { 
        transform: translateY(22px); 
        opacity: 0; 
      }
    }
    @keyframes sandAccumulate {
      0% { 
        transform: scaleY(0.5); 
        opacity: 0.6; 
      }
      100% { 
        transform: scaleY(1); 
        opacity: 0.9; 
      }
    }
    @keyframes timeGlow {
      0%, 100% { 
        transform: scale(1); 
        opacity: 0.4; 
      }
      50% { 
        transform: scale(1.5); 
        opacity: 0.8; 
      }
    }
    .motion-hourglass-frame {
      animation: hourglassRock 4s ease-in-out infinite;
      transform-origin: center center;
    }
    .motion-sand-top {
      animation: sandDeplete 6s ease-in infinite;
      transform-origin: center top;
    }
    .motion-sand-particle {
      animation: sandFall 2s ease-in infinite;
      transform-origin: center;
    }
    .motion-sand-bottom {
      animation: sandAccumulate 6s ease-out infinite;
      transform-origin: center bottom;
    }
    .motion-time-glow {
      animation: timeGlow 2.5s ease-in-out infinite;
      transform-origin: center;
    }
    
    /* Lottie Player Styling */
    lottie-player {
      display: block;
      margin: 0 auto;
    }
    
    /* Reduced Motion Override */
    @media (prefers-reduced-motion: reduce) {
      .question-motion-header * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      .motion-energy-core,
      .motion-energy-rays,
      .motion-energy-spark,
      .motion-mood-wave,
      .motion-focus-ring,
      .motion-focus-center,
      .motion-load-box,
      .motion-motivation-body,
      .motion-motivation-trail,
      .motion-hourglass-frame,
      .motion-sand-top,
      .motion-sand-particle,
      .motion-sand-bottom,
      .motion-time-glow,
      .result-blob-layer1,
      .result-blob-layer2,
      .result-blob-layer3 {
        animation: none !important;
      }
      lottie-player {
        display: none !important;
      }
    }
    
    @media (min-width: 768px) {
      .question-motion-header {
        max-width: 180px;
        height: 100px;
      }
    }
    /* Scale5 Input Styles */
    .scale5-ctn {
      width: 100%;
      margin-top: 32px;
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .scale5-btn {
      width: 100%;
      min-height: 68px;
      padding: 14px 20px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 16px;
      text-align: left;
      background: rgba(69, 79, 108, 0.4);
      border: 2px solid rgba(84, 95, 125, 0.6);
      border-radius: 20px;
      color: #e8e9ed;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      user-select: none;
      position: relative;
      overflow: hidden;
    }
    .scale5-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--option-color, #667eea);
      opacity: 0;
      transition: opacity 0.25s ease;
      z-index: 0;
    }
    .scale5-btn:hover {
      background: #5e739e;
      border-color: #3d5a80;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
      color: #fff;
    }
    .scale5-btn:hover::before {
      opacity: 0;
    }
    .scale5-btn:active {
      background: #4a5f88;
      border-color: #2d4563;
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25), inset 0 2px 4px rgba(0, 0, 0, 0.2);
      color: #fff;
    }
    .scale5-btn:active::before {
      opacity: 0;
    }
    .scale5-btn.selected {
      background: #fbbf24;
      border-color: #f59e0b;
      color: #1a1f4d;
      box-shadow: 0 8px 24px rgba(251, 191, 36, 0.4), 0 0 0 2px #fbbf24;
      transform: translateY(-1px);
    }
    .scale5-btn.selected::before {
      opacity: 0;
    }
    .scale5-btn.selected:hover {
      background: #fcd34d;
      border-color: #fbbf24;
      transform: translateY(-3px);
      box-shadow: 0 10px 28px rgba(251, 191, 36, 0.5), 0 0 0 2px #fbbf24;
      color: #1a1f4d;
    }
    .scale5-emoji {
      font-size: 34px;
      flex-shrink: 0;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.15));
      position: relative;
      z-index: 1;
    }
    .scale5-label {
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 0.3px;
      flex: 1;
      position: relative;
      z-index: 1;
    }
    /* Choice4 Input Styles */
    .choice4-ctn {
      width: 100%;
      margin-top: 32px;
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .choice4-btn {
      width: 100%;
      min-height: 68px;
      padding: 14px 20px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 16px;
      text-align: left;
      background: rgba(69, 79, 108, 0.4);
      border: 2px solid rgba(84, 95, 125, 0.6);
      border-radius: 20px;
      color: #e8e9ed;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      user-select: none;
      position: relative;
      overflow: hidden;
    }
    .choice4-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--option-color, #667eea);
      opacity: 0;
      transition: opacity 0.25s ease;
      z-index: 0;
    }
    .choice4-btn:hover {
      background: #5e739e;
      border-color: #3d5a80;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
      color: #fff;
    }
    .choice4-btn:hover::before {
      opacity: 0;
    }
    .choice4-btn:active {
      background: #4a5f88;
      border-color: #2d4563;
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25), inset 0 2px 4px rgba(0, 0, 0, 0.2);
      color: #fff;
    }
    .choice4-btn:active::before {
      opacity: 0;
    }
    .choice4-btn.selected {
      background: #fbbf24;
      border-color: #f59e0b;
      color: #1a1f4d;
      box-shadow: 0 8px 24px rgba(251, 191, 36, 0.4), 0 0 0 2px #fbbf24;
      transform: translateY(-1px);
    }
    .choice4-btn.selected::before {
      opacity: 0;
    }
    .choice4-btn.selected:hover {
      background: #fcd34d;
      border-color: #fbbf24;
      transform: translateY(-3px);
      box-shadow: 0 10px 28px rgba(251, 191, 36, 0.5), 0 0 0 2px #fbbf24;
      color: #1a1f4d;
    }
    .choice4-emoji {
      font-size: 34px;
      flex-shrink: 0;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.15));
      position: relative;
      z-index: 1;
    }
    .choice4-label {
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 0.3px;
      flex: 1;
      position: relative;
      z-index: 1;
    }
    /* Result Reveal Animation Styles */
    .result-reveal-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 70vh;
      width: 100%;
      padding: 60px 16px;
      margin: 0;
      box-sizing: border-box;
    }
    .result-orb {
      width: 180px;
      height: 180px;
      opacity: 0;
      transform: scale(0.5);
      transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
      margin-bottom: 32px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .result-orb.active {
      opacity: 1;
      transform: scale(1);
    }
    .result-orb.morphed {
      animation: none;
      transform: scale(1);
      transition: transform 0.5s ease-out;
    }
    .result-orb svg {
      width: 100%;
      height: 100%;
      filter: drop-shadow(0 8px 32px rgba(255, 179, 71, 0.4));
    }
    @media (min-width: 768px) {
      .result-orb {
        width: 270px;
        height: 270px;
      }
    }
    
    /* Morphing circle animation */
    @keyframes blobMorph1 {
      0%, 100% { 
        transform: translate(0, 0) scale(1);
        opacity: 0.9;
      }
      50% { 
        transform: translate(3px, -3px) scale(1.05);
        opacity: 0.85;
      }
    }
    @keyframes blobMorph2 {
      0%, 100% { 
        transform: translate(0, 0) scale(1);
        opacity: 0.75;
      }
      50% { 
        transform: translate(-4px, 4px) scale(0.95);
        opacity: 0.8;
      }
    }
    @keyframes blobMorph3 {
      0%, 100% { 
        transform: translate(0, 0) scale(1);
        opacity: 0.7;
      }
      50% { 
        transform: translate(2px, 5px) scale(1.08);
        opacity: 0.75;
      }
    }
    .result-blob-layer1 {
      animation: blobMorph1 6s ease-in-out infinite;
      transform-origin: center;
    }
    .result-blob-layer2 {
      animation: blobMorph2 7s ease-in-out infinite 0.5s;
      transform-origin: center;
    }
    .result-blob-layer3 {
      animation: blobMorph3 8s ease-in-out infinite 1s;
      transform-origin: center;
    }
    .result-vibe-title {
      font-size: 26px;
      font-weight: 700;
      color: #fff;
      opacity: 0;
      transform: scale(0.9) translateY(10px);
      transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      margin: 0 0 24px;
      text-align: center;
      line-height: 1.3;
      max-width: 320px;
    }
    .result-vibe-title.active {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
    .result-vibe-desc {
      font-size: 16px;
      font-weight: 400;
      color: #d4d6e0;
      line-height: 1.65;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.5s ease;
      margin-bottom: 40px;
      text-align: center;
      max-width: 300px;
    }
    .result-vibe-desc.active {
      opacity: 1;
      transform: translateY(0);
    }
    .result-cta-btn {
      width: auto;
      min-width: 240px;
      height: 56px;
      padding: 0 36px;
      border-radius: 28px;
      border: none;
      font-size: 17px;
      font-weight: 600;
      color: #1a1f4d;
      cursor: pointer;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      background: linear-gradient(90deg, #f4e87c, #ffd54f 80%);
    }
    .result-cta-btn.active {
      opacity: 1;
      transform: translateY(0);
    }
    .result-cta-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.25);
    }
    .result-cta-btn:active {
      transform: translateY(0) scale(0.98);
      background: linear-gradient(90deg, #f9edaf, #f4e87c);
    }
    .bottom-nav-wrapper {
      width: 100%;
      padding: 20px 0 0 0;
      flex-shrink: 0;
    }
    .bottom-nav {
      width: 100%;
      max-width: 358px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      z-index: 100;
      background: none;
    }
    .btn-back {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      padding: 0;
      width: 44px;
      height: 44px;
      min-width: 44px;
      min-height: 44px;
      transition: all 0.3s ease;
      visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      z-index: 3;
      opacity: 0.6;
    }
    .btn-back.visible {
      visibility: visible;
    }
    .btn-back:hover {
      color: #e8e9ed;
      opacity: 1;
    }
    .btn-back:active {
      transform: translateY(-50%) scale(0.95);
      opacity: 0.8;
    }
    .btn-continue {
      width: 140px; height: 52px;
      border-radius: 8px;
      background: linear-gradient(90deg,#f4e87c,#ffd54f 80%);
      color: var(--text-on-yellow);
      font-size: var(--font-btn);
      font-weight: 600;
      border: none;
      outline: none;
      box-shadow: var(--shadow-btn);
      cursor: pointer;
      display: none; /* Hidden since auto-advance */
      align-items: center;
      justify-content: center;
      transition: box-shadow 0.18s, background 0.18s, transform 0.09s, width 0.21s cubic-bezier(.22,1,.36,1);
      opacity: 0.4;
      pointer-events: none;
      gap: 9px;
      min-width: 90px; min-height: 44px;
    }
    .btn-continue.enabled {
      opacity: 1;
      pointer-events: auto;
    }
    .btn-continue:active { 
      background: linear-gradient(90deg,#f9edaf,#f4e87c); 
      transform: scale(0.98);
      box-shadow: var(--shadow-btn-active);
    }
    .btn-continue .spinner {
      display: inline-block; width:24px; height:24px; border:2.4px solid #fff3; border-radius:50%; border-top:2.4px solid #deca5d; animation: spin 1.1s linear infinite; box-sizing: border-box; }
    @keyframes spin { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }
    .home-indicator {
      position: fixed; bottom: 8px; left: 50%; transform:translateX(-50%);
      width: 120px; height: 5px; border-radius: 3px; background: #232649bb;
      opacity: 0.93;
      z-index: 201;
      pointer-events:none;
    }
    /* --- STATE RESULT STYLES --- */
    .state-screen {
      position: absolute; 
      top:0; 
      left:50%; 
      width:100%; 
      max-width:var(--iphone-width); 
      height: 100%; 
      z-index:800; 
      background: var(--gradient-bg); 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      padding: 0 16px; 
      padding-bottom: 40px;
      transition: opacity .42s, transform .46s var(--transition); 
      transform: translateX(-50%) translateY(100px) scale(0.99); 
      opacity: 0;
      pointer-events: none;
      overflow-y: auto;
      -ms-overflow-style: none;
      scrollbar-width: none;
      scroll-behavior: smooth;
    }
    .state-screen::-webkit-scrollbar {
      display: none;
    }
    .state-screen.active { opacity: 1; transform: translateX(-50%) translateY(0) scale(1); pointer-events: all; }
    .state-screen .header { width: 100%; min-height: 60px; height: 60px; background: transparent; display: flex; align-items: center; justify-content: flex-start; margin-top: 40px; position: relative; padding-left: 0; }
    .close-btn { width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; border-radius: 22px; background: none; color: var(--text-secondary); font-size: 28px; border: none; cursor: pointer; opacity: 0.8; transition: background 0.16s; }
    .close-btn:active { opacity: 1; background: rgba(255,255,255,0.05); }
    .overline { width: 100%; font-size: var(--font-overline); text-transform: uppercase; color: var(--text-secondary); letter-spacing: 1.5px; font-weight: 600; justify-content: center; align-items: center; text-align: center; margin-top: 24px; opacity: 0; transform: translateY(-8px); transition: opacity .22s, transform .26s; }
    .overline.revealed { opacity: 1; transform: translateY(0); transition-delay: .18s; }
    .hero-ctn { width: 100%; max-width: 345px; height: 340px; margin: 0 auto 0 auto; display: flex; align-items: center; justify-content: center; position: relative; pointer-events: none; opacity: 0; transform: scale(0.86); transition: opacity .32s .18s, transform .42s .15s cubic-bezier(.18,1.15,.31,1.03); }
    .hero-ctn.revealed { opacity: 1; transform: scale(1); }
    .state-label { font-size: 32px; font-weight: 700; color: #fff; text-align: center; letter-spacing: 0.3px; text-shadow: 0 2px 4px rgba(0,0,0,0.2); margin: 28px auto 0 auto; min-height: 42px; transition: opacity .21s .38s, transform .32s .38s; opacity: 0; transform: translateY(16px); }
    .state-label.revealed { opacity: 1; transform: translateY(0); }
    .state-screen .desc-card { background: var(--glass-card-bg); backdrop-filter: blur(10px); border-radius: 8px; border: 1px solid rgba(255,255,255,0.08); box-shadow: 0 4px 16px rgba(0,0,0,0.15); margin: 24px auto 0 auto; padding: 22px 24px; text-align: center; width: 100%; max-width: 358px; opacity: 0; transform: scale(0.96); transition: opacity .27s .48s, transform .28s .49s; color: var(--text-secondary); font-size: 16px; font-weight: 400; line-height: 1.5; }
    .state-screen .desc-card.revealed { opacity: 1; transform: scale(1); }
    .state-screen .energy-section { margin: 32px auto 0 auto; width: 100%; max-width: 358px; opacity: 0; transform: translateY(12px); transition: opacity .23s .44s, transform .29s .41s; }
    .state-screen .energy-section.revealed { opacity: 1; transform: translateY(0); }
    .energy-label-line { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 6px; }
    .energy-label { text-transform: uppercase; color: var(--text-secondary); font-size: 13px; font-weight: 600; letter-spacing: .5px; margin-left: 4px; }
    .energy-value { font-size: 18px; font-weight: bold; color: var(--accent-orange); text-shadow: 0 1px 2px rgba(0,0,0,0.23); min-width: 44px; text-align: right; }
    .energy-bar-ctn { width: 100%; height: 12px; border-radius: 6px; background: var(--dark-gray); box-shadow: 0 1px 3px rgba(0,0,0,0.3) inset; border: 1px solid rgba(255,255,255,0.05); position: relative; overflow: visible; margin-bottom: 10px; }
    .state-screen .energy-bar { height: 12px; border-radius: 6px; background: linear-gradient(90deg,var(--accent-yellow),var(--accent-orange) 100%); transition: width 0.8s cubic-bezier(.12,1.11,.16,1.05); box-shadow: 0 0 8px 0 #dec54a77, 0 1px 0px #fff3; will-change: width; position: relative; }
    .action-btn { position: fixed; bottom: calc(24px + env(safe-area-inset-bottom, 0px)); left: 50%; transform: translateX(-50%); width: calc(100% - 32px); max-width: 358px; height: var(--btn-height); border-radius: 8px; background: linear-gradient(90deg, var(--accent-coral), var(--accent-pink), var(--accent-orange)); box-shadow: 0 6px 20px 0 #ffb4a838; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: 600; color: var(--text-on-yellow); border: none; outline: none; cursor: pointer; z-index: 50; opacity: 0; transition: opacity .29s .58s, transform .27s .54s; }
    .action-btn.revealed { opacity:1; transform: translateX(-50%) scale(1.03); animation: btnBounceIn .6s 1 cubic-bezier(.41,1.44,.19,1.16); }
    @keyframes btnBounceIn { 0%{transform:translateX(-50%) scale(.93)} 60%{transform:translateX(-50%) scale(1.06)} 100%{transform:translateX(-50%) scale(1.03)} }
    .hero-svg { width: 206px; height: 206px; border-radius: 100px; background: radial-gradient(circle at 110px 39px, #ffe2db 32%, #febead77 67%, #ffb4a827 97%); display: flex; align-items: center; justify-content: center; box-shadow: 0 0 22px 5px #ffb78635, 0 0 0 0 #fff0; position: relative; animation: heroPulse 3s ease-in-out infinite alternate; }
    @keyframes heroPulse { from { box-shadow: 0 0 18px 4px #ffb78628, 0 0 0 0 #fff0; } to { box-shadow: 0 0 32px 12px #ffb78642, 0 0 15px 9px #ffd54f11; } }
    .hero-brain { width: 130px; height: 112px; border-radius: 70px/65px; background: radial-gradient(circle, #fff6 55%, #ffb6b6 83%, #febead 100%), linear-gradient(120deg,#ffb4a8 60%, #ff9aa2 90%); opacity: .93; margin-top: 22px; box-shadow: 0 1px 16px #ffb4a88a; }
    /* Responsive for iOS 16 Pro and smaller devices */
    @media (max-width: 430px) {
      .glass-card { max-width: 350px; }
    }
    @media (max-width: 395px) {
      .glass-card { max-width: 100%; }
      .state-screen .desc-card, .action-btn, .state-screen .energy-section, .hero-ctn { max-width: 100% !important; }
    }
    @media (max-height: 850px) {
      .card-slide-ctn { height: auto; min-height: 360px; max-height: 480px; }
    }
    @media (max-width: 375px) {
      .glass-card { max-width: 100%; padding: 20px; }
      .card-slide-ctn { height: auto; }
    }
    @media (max-width: 320px) {
      .glass-card { padding: 20px; }
      .status-bar, .header { min-height: 40px; height: auto; }
      .state-label, .title { font-size: 20px; }
      .card-slide-ctn { height: auto; }
    }
    /* --- TASK RECOMMENDATION SCREEN STYLES --- */
    .task-screen {
      position: absolute; 
      top:0; 
      left:50%; 
      width:100%; 
      max-width:var(--iphone-width); 
      height: 100%;
      z-index:900; 
      background: var(--gradient-bg); 
      display: flex; 
      flex-direction: column; 
      overflow-y: auto; 
      overflow-x: hidden; 
      transform: translateX(-50%) translateY(100px) scale(0.99); 
      opacity: 0; 
      transition: opacity .42s, transform .46s var(--transition); 
      pointer-events: none;
      -ms-overflow-style: none;
      scrollbar-width: none;
      scroll-behavior: smooth;
    }
    .task-screen::-webkit-scrollbar {
      display: none;
    }
    .task-screen.active { opacity: 1; transform: translateX(-50%) translateY(0) scale(1); pointer-events: all; }
    .task-header {
      position: fixed; 
      top:0; 
      left:50%; 
      transform: translateX(-50%);
      width:100%; 
      max-width:var(--iphone-width); 
      height:auto; 
      background: linear-gradient(180deg, var(--gradient-bg) 0%, rgba(26,31,77,0.80) 100%); 
      backdrop-filter: blur(20px); 
      z-index:100; 
      padding-top:calc(16px + env(safe-area-inset-top, 0px)); 
      padding-left:16px; 
      padding-right:16px; 
      padding-bottom:12px; 
      display:flex; 
      flex-direction: column;
      gap: 12px;
      border-bottom:1px solid rgba(255,255,255,0.08); 
      box-shadow:0 2px 8px rgba(0,0,0,0.1);
      box-sizing: border-box;
    }
    .task-header-row {
      display:flex; justify-content:space-between; align-items:center; width:100%;
    }
    .task-state-summary { font-size:15px; color:#fff; line-height:1.3; flex:1; }
    .task-state-summary .state-name { font-weight:600; }
    .task-header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .view-toggle-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }
    .view-toggle-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: scale(1.05);
    }
    .view-toggle-btn:active {
      transform: scale(0.95);
      background: rgba(255, 255, 255, 0.2);
    }
    .task-avatar { width:36px; height:36px; border-radius:50%; border:2px solid rgba(255,255,255,0.2); background:linear-gradient(135deg,#ffb4a8,#89cff0); display:flex; align-items:center; justify-content:center; font-size:18px; flex-shrink:0; }
    .view-tabs {
      display: flex;
      gap: 8px;
      width: 100%;
      height: 36px;
    }
    .view-tab-btn {
      flex: 1;
      height: 36px;
      padding: 8px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.15s ease, border-color 0.15s ease, color 0.15s ease;
      box-sizing: border-box;
    }
    .view-tab-btn:hover {
      background: rgba(255, 255, 255, 0.08);
    }
    .view-tab-btn.active {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.2);
      color: #fff;
    }
    .view-tab-btn:active {
      transform: scale(0.98);
    }
    .plan-day-selector {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      width: 100%;
      height: 36px;
    }
    .plan-day-btn {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.05);
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
    }
    .plan-day-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    .plan-day-btn:active {
      transform: scale(0.9);
    }
    .plan-day-label {
      font-size: 15px;
      font-weight: 600;
      color: #fff;
      min-width: 80px;
      text-align: center;
    }
    .task-content { 
      margin-top:calc(160px + env(safe-area-inset-top, 0px)); 
      padding:20px 16px; 
      padding-bottom:calc(96px + env(safe-area-inset-bottom, 0px)); 
      max-width: 100%;
      opacity: 1;
      transition: opacity 0.18s ease-in-out;
      box-sizing: border-box;
    }
    .task-tip-banner {
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 24px;
      font-size: 14px;
      font-weight: 500;
      color: #e8e9ed;
      line-height: 1.5;
      text-align: center;
      max-width: 100%;
      word-wrap: break-word;
    }
    .task-section-header {
      display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; margin-top:24px;
    }
    .task-section-header:first-child { margin-top:0; }
    .task-section-title { font-size:18px; font-weight:600; color:#fff; letter-spacing:0.3px; }
    .task-info-btn { width:20px; height:20px; border-radius:50%; border:1px solid var(--text-secondary); background:none; color:var(--text-secondary); display:flex; align-items:center; justify-content:center; font-size:12px; cursor:pointer; transition:all .15s; }
    .task-info-btn:active { background:rgba(255,255,255,0.1); transform:scale(0.9); }
    .task-back-btn { transition:all .15s; }
    .task-back-btn:active { color:#f4e87c; transform:scale(0.9); }
    .task-card {
      width:100%; max-width:100%; min-height:110px; background:rgba(45,53,88,0.95); border-radius:8px; border:1px solid rgba(255,255,255,0.08); box-shadow:0 4px 12px rgba(0,0,0,0.15); margin-bottom:12px; position:relative; display:flex; overflow:hidden; transition:transform .15s, box-shadow .18s; backdrop-filter:blur(8px); box-sizing:border-box;
    }
    .task-card:active { transform:scale(0.98); box-shadow:0 6px 16px rgba(0,0,0,0.2); }
    .task-card.completed { opacity:0.5; }
    .task-color-strip {
      position:absolute; left:0; top:0; bottom:0; width:6px; border-radius:8px 0 0 8px;
    }
    .task-card.creative .task-color-strip { background:#ffb4a8; }
    .task-card.focused .task-color-strip { background:#89cff0; }
    .task-card.wellness .task-color-strip { background:#b5e7a0; }
    .task-card.flexible .task-color-strip { background:#f4e87c; }
    .task-icon-ctn {
      width:56px; height:56px; margin:16px 0 16px 16px; display:flex; align-items:center; justify-content:center; flex-shrink:0;
    }
    .task-icon-circle {
      width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:24px;
    }
    .task-card.creative .task-icon-circle { background:rgba(255,180,168,0.20); }
    .task-card.focused .task-icon-circle { background:rgba(137,207,240,0.20); }
    .task-card.wellness .task-icon-circle { background:rgba(181,231,160,0.20); }
    .task-card.flexible .task-icon-circle { background:rgba(244,232,124,0.20); }
    .task-card-content {
      flex:1; padding:16px 16px 16px 0; display:flex; flex-direction:column;
    }
    .task-title {
      font-size:16px; font-weight:600; color:#fff; line-height:1.3; margin-bottom:6px; min-height:20px;
    }
    .task-card.completed .task-title { text-decoration:line-through; }
    .task-metadata {
      font-size:14px; color:var(--text-secondary); margin-bottom:8px; display:flex; align-items:center; gap:6px;
    }
    .task-ai-reasoning {
      font-size:13px; font-style:italic; padding:8px 12px 6px; border-radius:8px; margin-top:4px; display:inline-block; max-width:fit-content;
    }
    .task-card.creative .task-ai-reasoning { color:#ffb4a8; background:rgba(255,180,168,0.10); }
    .task-card.focused .task-ai-reasoning { color:#89cff0; background:rgba(137,207,240,0.10); }
    .task-card.wellness .task-ai-reasoning { color:#b5e7a0; background:rgba(181,231,160,0.10); }
    .task-card.flexible .task-ai-reasoning { color:#f4e87c; background:rgba(244,232,124,0.10); }
    .task-action-ctn {
      width:48px; display:flex; align-items:center; justify-content:center; padding-right:16px; flex-shrink:0;
    }
    .task-checkbox {
      width:28px; height:28px; border-radius:50%; border:2px solid var(--text-secondary); background:none; display:flex; align-items:center; justify-content:center; cursor:pointer; transition:all .2s;
    }
    .task-checkbox.checked { background:#4caf50; border-color:#4caf50; }
    .task-checkbox.checked:after { content:'âœ“'; color:#fff; font-size:18px; font-weight:bold; }
    .task-start-btn {
      width:80px; height:36px; border-radius:8px; border:none; font-size:15px; font-weight:600; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:transform .12s, box-shadow .15s;
    }
    .task-card.creative .task-start-btn { background:linear-gradient(90deg,#ffb4a8,#ff9aa2); color:var(--text-on-yellow); box-shadow:0 2px 8px rgba(255,180,168,0.30); }
    .task-card.focused .task-start-btn { background:linear-gradient(90deg,#89cff0,#6ec6e6); color:var(--text-on-yellow); box-shadow:0 2px 8px rgba(137,207,240,0.30); }
    .task-card.wellness .task-start-btn { background:linear-gradient(90deg,#b5e7a0,#9dd885); color:var(--text-on-yellow); box-shadow:0 2px 8px rgba(181,231,160,0.30); }
    .task-card.flexible .task-start-btn { background:linear-gradient(90deg,#f4e87c,#ffd54f); color:var(--text-on-yellow); box-shadow:0 2px 8px rgba(244,232,124,0.30); }
    .task-start-btn:active { transform:scale(0.95); }
    .task-fab {
      display: none;
    }
    /* Bottom Tab Bar */
    .bottom-tab-bar {
      position: fixed !important;
      bottom: 0 !important;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: var(--iphone-width);
      height: calc(72px + env(safe-area-inset-bottom, 0px));
      background: linear-gradient(180deg, rgba(26,31,77,0.95) 0%, rgba(26,31,77,0.98) 100%);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-top: 1px solid rgba(255,255,255,0.08);
      display: flex;
      align-items: flex-start;
      justify-content: space-around;
      padding: 8px 16px calc(env(safe-area-inset-bottom, 0px) + 8px);
      z-index: 1100;
      box-sizing: border-box;
      pointer-events: auto;
      will-change: transform;
    }
    .tab-btn {
      background: none;
      border: none;
      color: var(--text-secondary);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 12px;
      transition: all 0.2s ease;
      flex: 1;
      max-width: 80px;
    }
    .tab-btn:active {
      transform: scale(0.95);
    }
    .tab-btn.active {
      color: #f4e87c;
    }
    .tab-btn.active .tab-icon {
      transform: scale(1.1);
    }
    .tab-icon {
      font-size: 22px;
      transition: transform 0.2s ease;
    }
    .tab-label {
      font-size: 11px;
      font-weight: 500;
      letter-spacing: 0.2px;
    }
    /* Edit Mood Button */
    .edit-mood-btn {
      background: linear-gradient(90deg, #f4e87c, #ffd54f);
      color: var(--text-on-yellow);
      border: none;
      border-radius: 20px;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .edit-mood-btn:active {
      transform: scale(0.95);
    }
    /* Mood Screen Styles */
    .mood-date-section {
      margin-bottom: 20px;
    }
    .mood-date-section h3 {
      color: #fff;
      font-size: 18px;
      font-weight: 600;
      margin: 0 0 16px;
    }
    .mood-answers-section {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 24px;
    }
    .mood-answer-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }
    .mood-answer-item:last-child {
      border-bottom: none;
    }
    .mood-label {
      color: var(--text-secondary);
      font-size: 15px;
      font-weight: 500;
    }
    .mood-value {
      color: #fff;
      font-size: 15px;
      font-weight: 600;
    }
    .mood-history-section h3 {
      color: #fff;
      font-size: 18px;
      font-weight: 600;
      margin: 0 0 16px;
    }
    .mood-history-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .mood-history-item {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .mood-history-item:hover {
      background: rgba(255, 255, 255, 0.06);
    }
    .mood-history-item:active {
      transform: scale(0.98);
    }
    .history-date {
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 6px;
    }
    .history-summary {
      color: #fff;
      font-size: 15px;
      font-weight: 600;
    }
    /* Tips Screen Styles */
    .tip-card {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
      transition: all 0.2s ease;
    }
    .tip-card:hover {
      background: rgba(255, 255, 255, 0.06);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    .tip-icon {
      font-size: 32px;
      margin-bottom: 12px;
    }
    .tip-title {
      color: #fff;
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .tip-desc {
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.5;
    }
    /* Profile Screen Styles */
    .profile-section {
      text-align: center;
      padding: 24px 0;
      margin-bottom: 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }
    .profile-avatar-large {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      margin: 0 auto 16px;
      border: 3px solid rgba(255, 255, 255, 0.1);
    }
    .profile-name {
      color: #fff;
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    .profile-email {
      color: var(--text-secondary);
      font-size: 14px;
    }
    .profile-info-section {
      margin-bottom: 24px;
    }
    .profile-info-section h3 {
      color: #fff;
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 12px;
    }
    .profile-info-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }
    .profile-info-item:last-child {
      border-bottom: none;
    }
    .info-label {
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
    }
    .info-value {
      color: #fff;
      font-size: 14px;
      font-weight: 600;
    }
    .action-btn {
      background: linear-gradient(90deg, #f4e87c, #ffd54f);
      color: var(--text-on-yellow);
      border: none;
      border-radius: 12px;
      padding: 14px 24px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: block;
      margin: 0 auto;
    }
    .action-btn:active {
      transform: scale(0.97);
    }
    .secondary-btn {
      background: rgba(255, 255, 255, 0.08);
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 12px;
      padding: 14px 24px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: block;
      margin: 0 auto;
    }
    .secondary-btn:active {
      transform: scale(0.97);
      background: rgba(255, 255, 255, 0.12);
    }
    .compact-task-card {
      min-height:80px; padding:12px; margin-bottom:8px;
    }
    .compact-task-card .task-icon-ctn { width:48px; height:48px; margin:12px 0 12px 12px; }
    .compact-task-card .task-icon-circle { width:32px; height:32px; font-size:20px; }
    .compact-task-card .task-card-content { padding:12px 12px 12px 0; }
    .compact-task-card .task-title { font-size:15px; margin-bottom:4px; }
    .compact-task-card .task-metadata { font-size:13px; margin-bottom:4px; }
    .compact-task-card .task-ai-reasoning { display:none; }
    .task-divider {
      height:1px; background:rgba(255,255,255,0.1); margin:24px 0 16px;
    }
    @media (max-width: 395px) {
      .task-content { padding:20px 16px; }
      .task-card { width:100%; max-width:100%; }
    }
    /* --- TIMELINE VIEW SCREEN STYLES --- */
    .timeline-screen {
      position: absolute; 
      top:0; 
      left:50%; 
      width:100%; 
      max-width:var(--iphone-width); 
      height: 100%; 
      z-index:950; 
      background: var(--gradient-bg); 
      display: flex; 
      flex-direction: column; 
      overflow-y: auto; 
      overflow-x: hidden; 
      transform: translateX(-50%) translateY(100px) scale(0.99); 
      opacity: 0; 
      transition: opacity .42s, transform .46s var(--transition); 
      pointer-events: none;
      -ms-overflow-style: none;
      scrollbar-width: none;
      scroll-behavior: smooth;
    }
    .timeline-screen::-webkit-scrollbar {
      display: none;
    }
    .timeline-screen.active { opacity: 1; transform: translateX(-50%) translateY(0) scale(1); pointer-events: all; }
    .timeline-header {
      position: fixed; 
      top:0; 
      left:50%; 
      transform: translateX(-50%);
      width:100%; 
      max-width:var(--iphone-width); 
      height:auto; 
      background: linear-gradient(180deg, var(--gradient-bg) 0%, rgba(26,31,77,0.80) 100%); 
      backdrop-filter: blur(20px); 
      z-index:100; 
      padding-top:calc(16px + env(safe-area-inset-top, 0px)); 
      padding-left:16px; 
      padding-right:16px; 
      padding-bottom:12px; 
      display:flex; 
      flex-direction:column; 
      gap: 12px;
      border-bottom:1px solid rgba(255,255,255,0.08); 
      box-shadow:0 2px 8px rgba(0,0,0,0.1);
      box-sizing: border-box;
    }
    .timeline-header-row {
      display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;
    }
    .timeline-date-ctn {
      display:flex; align-items:center; gap:12px;
    }
    .timeline-date {
      font-size:20px; font-weight:700; color:#fff; margin:0;
    }
    .timeline-date-arrow {
      width:24px; height:24px; border-radius:12px; border:1px solid var(--text-secondary); background:none; color:var(--text-secondary); display:flex; align-items:center; justify-content:center; font-size:14px; cursor:pointer; transition:all .15s;
    }
    .timeline-date-arrow:active { background:rgba(255,255,255,0.1); transform:scale(0.9); }
    .timeline-header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .timeline-energy-badge {
      padding:6px 12px; border-radius:16px; background:rgba(244,232,124,0.20); font-size:12px; font-weight:600; color:#fff; display:flex; align-items:center; gap:6px;
    }
    .timeline-stats {
      text-align:center; font-size:13px; color:var(--text-secondary); margin-top:4px;
    }
    .timeline-content {
      margin-top:calc(160px + env(safe-area-inset-top, 0px)); 
      padding:0 16px; 
      padding-bottom:calc(96px + env(safe-area-inset-bottom, 0px)); 
      display:flex; 
      position:relative;
      opacity: 1;
      transition: opacity 0.18s ease-in-out;
    }
    .timeline-time-col {
      width:50px; flex-shrink:0; position:sticky; left:16px; background:var(--gradient-bg); z-index:10; padding:8px 8px 8px 0;
    }
    .timeline-time-label {
      font-size:13px; font-weight:500; color:var(--text-secondary); text-align:right; height:100px; display:flex; align-items:flex-start; justify-content:flex-end; padding-top:8px; position:relative;
    }
    .timeline-time-label.current { font-weight:700; color:#ffd54f; }
    .timeline-time-label.current:before {
      content:''; position:absolute; left:-6px; top:12px; width:4px; height:4px; border-radius:50%; background:#ffd54f; box-shadow:0 0 6px #ffd54f;
    }
    .timeline-time-tick {
      position:absolute; left:-2px; top:50px; width:1px; height:6px; background:rgba(255,255,255,0.1);
    }
    .timeline-task-col {
      flex:1; position:relative; padding:8px 8px 8px 8px; min-height:1700px;
    }
    .timeline-hour-line {
      height:1px; width:100%; background:rgba(255,255,255,0.08); margin:0; position:absolute;
    }
    .timeline-hour-line.half {
      background:rgba(255,255,255,0.03); border-top:1px dashed rgba(255,255,255,0.1);
    }
    .timeline-task-block {
      position:absolute; width:calc(100% - 16px); border-radius:8px; border:2px solid; box-shadow:0 2px 6px rgba(0,0,0,0.15); padding:8px; margin:2px; display:flex; flex-direction:column; cursor:grab; transition:transform .15s, box-shadow .18s; z-index:20;
    }
    .timeline-task-block:active { cursor:grabbing; transform:scale(1.02); box-shadow:0 6px 16px rgba(0,0,0,0.2); z-index:30; }
    .timeline-task-block.creative { background:rgba(255,180,168,0.85); border-color:#ffb4a8; }
    .timeline-task-block.focused { background:rgba(137,207,240,0.85); border-color:#89cff0; }
    .timeline-task-block.wellness { background:rgba(181,231,160,0.85); border-color:#b5e7a0; }
    .timeline-task-block.flexible { background:rgba(244,232,124,0.85); border-color:#f4e87c; }
    .timeline-task-block.dragging { opacity:0.8; transform:scale(1.05) rotate(2deg); z-index:50; }
    .timeline-task-block.completed { opacity:0.4; }
    .timeline-task-strip {
      position:absolute; left:0; top:0; bottom:0; width:3px; border-radius:8px 0 0 8px;
    }
    .timeline-task-block.creative .timeline-task-strip { background:#ffb4a8; }
    .timeline-task-block.focused .timeline-task-strip { background:#89cff0; }
    .timeline-task-block.wellness .timeline-task-strip { background:#b5e7a0; }
    .timeline-task-block.flexible .timeline-task-strip { background:#f4e87c; }
    .timeline-task-title {
      font-size:15px; font-weight:600; color:#fff; line-height:1.2; margin-bottom:4px; text-shadow:0 1px 2px rgba(0,0,0,0.3);
    }
    .timeline-task-duration {
      position:absolute; bottom:8px; left:8px; background:rgba(255,255,255,0.20); padding:4px 8px 2px; border-radius:6px; font-size:11px; font-weight:600; text-transform:uppercase; color:#fff;
    }
    .timeline-current-time {
      position:absolute; left:0; right:0; height:2px; background:#ff6b6b; box-shadow:0 0 6px #ff6b6b77; z-index:40; pointer-events:none;
    }
    .timeline-current-time:before {
      content:''; position:absolute; left:-4px; top:-3px; width:8px; height:8px; border-radius:50%; background:#ff6b6b; box-shadow:0 0 8px #ff6b6b;
    }
    .timeline-current-time:after {
      content:''; position:absolute; right:-5px; top:-4px; width:0; height:0; border-left:5px solid transparent; border-right:5px solid transparent; border-top:8px solid #ff6b6b;
    }
    .timeline-empty-slot {
      position:absolute; border:2px dashed rgba(74,79,107,0.40); border-radius:8px; background:transparent; display:flex; flex-direction:column; align-items:center; justify-content:center; color:var(--text-secondary); font-size:13px; cursor:pointer; transition:all .2s;
    }
    .timeline-empty-slot:hover { background:rgba(255,255,255,0.05); border-color:rgba(255,255,255,0.20); }
    .timeline-empty-slot-text { margin-bottom:4px; }
    .timeline-empty-slot-icon { font-size:18px; opacity:0.6; }
    .timeline-actions {
      position:fixed; bottom:calc(24px + env(safe-area-inset-bottom, 0px)); left:0; right:0; width:100%; max-width:var(--iphone-width); height:60px; margin:0 auto; background:rgba(31,36,66,0.90); backdrop-filter:blur(10px); border-top:1px solid rgba(255,255,255,0.08); display:flex; justify-content:space-around; align-items:center; padding:8px 16px; z-index:90;
    }
    .timeline-action-btn {
      display:flex; flex-direction:column; align-items:center; gap:4px; background:none; border:none; color:var(--text-secondary); font-size:24px; cursor:pointer; transition:all .15s; padding:4px 12px;
    }
    .timeline-action-btn:active { transform:scale(0.9); color:#f4e87c; }
    .timeline-action-label { font-size:13px; color:var(--text-secondary); }
    .timeline-back-btn {
      position:absolute; left:16px; top:calc(12px + env(safe-area-inset-top, 0px)); width:32px; height:32px; background:none; border:none; color:var(--text-secondary); font-size:20px; cursor:pointer; z-index:101; transition:all .15s;
    }
    .timeline-back-btn:active { color:#f4e87c; transform:scale(0.9); }
    @media (max-width: 395px) {
      .timeline-task-col { padding:8px 8px 8px 6px; }
      .timeline-time-col { width:42px; }
    }
  </style>
</head>
<body>
  <div class="device-frame">
    <div class="ios-status-bar">
      <div class="status-left">9:41</div>
      <div class="dynamic-island"></div>
      <div class="status-right">
        <div class="status-icons">
          <svg width="18" height="12" viewBox="0 0 18 12" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M16.5 1.5L18 3L18 9L16.5 10.5M0 3L1.5 1.5L4.5 1.5L6 3L6 9L4.5 10.5L1.5 10.5L0 9L0 3ZM7.5 3L9 1.5L12 1.5L13.5 3L13.5 9L12 10.5L9 10.5L7.5 9L7.5 3Z" fill="white"/>
          </svg>
          <svg width="17" height="12" viewBox="0 0 17 12" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15.5 5C15.5 7.48528 13.4853 9.5 11 9.5C8.51472 9.5 6.5 7.48528 6.5 5C6.5 2.51472 8.51472 0.5 11 0.5C13.4853 0.5 15.5 2.51472 15.5 5Z" fill="white"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M11 12C15.4183 12 19 9.31371 19 6C19 2.68629 15.4183 0 11 0C6.58172 0 3 2.68629 3 6C3 9.31371 6.58172 12 11 12ZM11 9.5C13.4853 9.5 15.5 7.48528 15.5 5C15.5 2.51472 13.4853 0.5 11 0.5C8.51472 0.5 6.5 2.51472 6.5 5C6.5 7.48528 8.51472 9.5 11 9.5Z" fill="white"/>
          </svg>
          <svg width="27" height="13" viewBox="0 0 27 13" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="0.5" y="0.5" width="22" height="11" rx="2.5" stroke="white" fill="none"/>
            <rect opacity="0.4" x="2" y="2" width="18" height="8" rx="1" fill="white"/>
            <path d="M24 4.5C24 4.22386 24.2239 4 24.5 4H25.5C25.7761 4 26 4.22386 26 4.5V8.5C26 8.77614 25.7761 9 25.5 9H24.5C24.2239 9 24 8.77614 24 8.5V4.5Z" fill="white" fill-opacity="0.4"/>
          </svg>
        </div>
      </div>
    </div>
    <div class="app-header">
      <h1>Daily Check-in</h1>
    </div>
    <div class="safe-area">
      <div id="router-ctn"></div>
    </div>
  </div>
  <script>
    // ---- Data & Helpers (shared for check-in & state) ----
    const questions = [
      { type:'scale5', id:"energy", indicator: 'Question 1 of 6', question: "How mentally energized and awake do you feel right now?", subtext: 'Rate your current mental sharpness and alertness.', hero:'sun', heroGradient:'linear-gradient(135deg, #667eea 0%, #764ba2 100%, #f093fb 100%)', options: [ {label:'Exhausted', value:0, emoji:'ðŸ˜´', color:'#6b7280'}, {label:'Very Low', value:2, emoji:'ðŸ˜ª', color:'#8b92a8'}, {label:'Okay', value:5, emoji:'ðŸ˜', color:'#a8b0c8'}, {label:'High', value:8, emoji:'ðŸ™‚', color:'#5e739e'}, {label:'Sharp', value:10, emoji:'âš¡', color:'#5e739e'} ] },
      { type:'scale5', id:"mood", indicator: 'Question 2 of 6', question: "How would you describe your mood right now?", subtext: 'Your emotional tone in this moment.', hero:'wave', heroGradient:'linear-gradient(135deg, #a8b0c8 0%, #fbbf24 50%, #f59e0b 100%)', options: [ {label:'Low', value:0, emoji:'ðŸ˜•', color:'#6b7280'}, {label:'Flat', value:2, emoji:'ðŸ˜', color:'#8b92a8'}, {label:'Neutral', value:5, emoji:'ðŸ™‚', color:'#a8b0c8'}, {label:'Upbeat', value:8, emoji:'ðŸ˜Š', color:'#5e739e'}, {label:'Elevated', value:10, emoji:'ðŸ˜„', color:'#5e739e'} ] },
      { type:'scale5', id:"focus", indicator: 'Question 3 of 6', question: "How easy is it to concentrate right now?", subtext: 'From very distracted to laser-focused.', hero:'lens', heroGradient:'linear-gradient(135deg, #a8b0c8 0%, #89cff0 100%)', options: [ {label:'Very Distracted', value:0, emoji:'ðŸŒ€', color:'#6b7280'}, {label:'Scattered', value:2, emoji:'ðŸ˜µâ€ðŸ’«', color:'#8b92a8'}, {label:'Average', value:5, emoji:'ðŸ˜', color:'#a8b0c8'}, {label:'Focused', value:8, emoji:'ðŸŽ¯', color:'#89cff0'}, {label:'Laser-Focused', value:10, emoji:'ðŸ”', color:'#667eea'} ] },
      { type:'scale5', id:"load", indicator: 'Question 4 of 6', question: "How mentally loaded or overloaded do you feel?", subtext: 'Weight of information/pressure on your mind right now.', hero:'stack', heroGradient:'linear-gradient(135deg, #b5e7a0 0%, #fbbf24 50%, #ff6b6b 100%)', options: [ {label:'Clear', value:0, emoji:'ðŸŒ¿', color:'#b5e7a0'}, {label:'Light', value:2, emoji:'â˜ï¸', color:'#a8b0c8'}, {label:'Manageable', value:5, emoji:'ðŸ“¦', color:'#5e739e'}, {label:'Heavy', value:8, emoji:'ðŸ˜£', color:'#5e739e'}, {label:'Overloaded', value:10, emoji:'ðŸ”¥', color:'#5e739e'} ] },
      { type:'scale5', id:"motivation", indicator: 'Question 5 of 6', question: "How ready do you feel to start your next task?", subtext: 'Your willingness and drive to begin.', hero:'rocket', heroGradient:'linear-gradient(135deg, #6b7280 0%, #fbbf24 50%, #f59e0b 100%)', options: [ {label:'Stuck', value:0, emoji:'ðŸ§±', color:'#6b7280'}, {label:'Low', value:2, emoji:'ðŸ˜”', color:'#8b92a8'}, {label:'Willing', value:5, emoji:'ðŸ™‚', color:'#a8b0c8'}, {label:'Ready', value:8, emoji:'ðŸ’ª', color:'#5e739e'}, {label:'Eager', value:10, emoji:'ðŸš€', color:'#5e739e'} ] },
      { type:'choice4', id:"pressure", indicator: 'Question 6 of 6', question: "How much time pressure are you under today?", subtext: 'Choose the option that best describes how rushed or free you feel.', hero:'clock', heroGradient:'linear-gradient(135deg, #b5e7a0 0%, #fbbf24 50%, #ff6b6b 100%)', answers: [ {label:'Plenty of time', value:10, emoji:'ðŸ•°ï¸', color:'#b5e7a0'}, {label:'Some pressure', value:50, emoji:'â°', color:'#5e739e'}, {label:'Urgent', value:85, emoji:'â³', color:'#5e739e'}, {label:'Critical', value:100, emoji:'âš¡', color:'#5e739e'} ] }
    ];
    const VIBE_CONFIG = {
      focus: { icon:'ðŸŽ¯', label:'Focus', summary:'Primed for sustained, detail-oriented work.', tip:'Silence notifications and tackle one deep task for 50â€“90 minutes.', activities:['deep work','analysis','structured writing','debugging'] },
      creative: { icon:'ðŸŒˆ', label:'Creative', summary:'Mood and energy support divergent thinking and synthesis.', tip:"Spend 30 minutes exploring ideasâ€”don't edit yet.", activities:['ideation','planning','strategy','design explorations'] },
      recovery: { icon:'ðŸŒ¿', label:'Recovery', summary:'Energy limitedâ€”choose low-stakes, momentum-building work.', tip:'Pick one small task to regain momentum.', activities:['admin','reading','light edits','short errands'] },
      overloaded: { icon:'ðŸ”¥', label:'Overloaded', summary:'Cognitive load is highâ€”triage and simplify first.', tip:'Remove two non-critical items before starting.', activities:['triage','planning','de-scoping','quick alignment'] },
      collaborative: { icon:'ðŸ¤', label:'Collaborative', summary:'Ideal for communication, reviews, and alignment.', tip:'Write a 3-point agenda and time-box the call.', activities:['meetings','reviews','feedback','outreach'] }
    };
    // ---- Scroll to Top Helper ----
    function scrollToTop(smooth = true) {
      const safeArea = document.querySelector('.safe-area');
      const taskScreen = document.querySelector('.task-screen.active');
      const timelineScreen = document.querySelector('.timeline-screen.active');
      
      // Scroll the appropriate container to top
      if (safeArea) {
        safeArea.scrollTo({
          top: 0,
          behavior: smooth ? 'smooth' : 'auto'
        });
      }
      if (taskScreen) {
        taskScreen.scrollTo({
          top: 0,
          behavior: smooth ? 'smooth' : 'auto'
        });
      }
      if (timelineScreen) {
        timelineScreen.scrollTo({
          top: 0,
          behavior: smooth ? 'smooth' : 'auto'
        });
      }
      
      // Also scroll window for good measure
      window.scrollTo({
        top: 0,
        behavior: smooth ? 'smooth' : 'auto'
      });
    }
    // ---- Main Check-in SPA Logic ----
    function renderCheckin(cancelCallback = null) {
      // Scroll to top on page load
      scrollToTop();
      
      // Reset header title
      const appHeader = document.querySelector('.app-header h1');
      if (appHeader) appHeader.textContent = 'Daily Check-in';
      
      const c = document.getElementById('router-ctn');
      c.innerHTML = `<div class="header-row">
        <button class="btn-back" id="backBtn">Back</button>
        <div class="progress" id="progressDots"></div>
      </div>
      <div class="card-slide-ctn" id="cardCtn"></div>
      <div class="bottom-nav-wrapper">
        <div class="bottom-nav">
          <button class="btn-continue" id="continueBtn"><span id="continueBtnText">Continue â†’</span></button>
        </div>
      </div>
      <div class="home-indicator"></div>`;
      let qIdx = 0, answers = [null, null, null, null, null, null], animDir = 1;
      const progressDots = c.querySelector('#progressDots'), cardCtn = c.querySelector('#cardCtn'), continueBtn = c.querySelector('#continueBtn'), continueBtnText = c.querySelector('#continueBtnText'), backBtn = c.querySelector('#backBtn');
      function renderProgress() {
        progressDots.innerHTML = '';
        for (let i = 0; i < questions.length; i++) {
          let dot = document.createElement('div');
          dot.className = 'prog-dot';
          if (i < qIdx) {
            dot.classList.add('past');
          } else if(i === qIdx) {
            dot.classList.add('current');
          }
          progressDots.appendChild(dot);
        }
      }
      function buildScale5(q, value) {
        const wrap = document.createElement('div');
        wrap.className = 'scale5-ctn';
        q.options.forEach(opt => {
          const btn = document.createElement('button');
          btn.className = 'scale5-btn';
          btn.setAttribute('tabindex', '0');
          btn.setAttribute('aria-label', opt.label);
          btn.style.setProperty('--option-color', opt.color);
          btn.innerHTML = `<div class="scale5-emoji">${opt.emoji}</div><div class="scale5-label">${opt.label}</div>`;
          if (value === opt.value) btn.classList.add('selected');
          btn.addEventListener('click', () => { 
            answers[qIdx] = opt.value; 
            btn.classList.add('selected');
            // Auto-advance after short delay for feedback
            setTimeout(() => {
              if(qIdx < questions.length - 1) {
                goTo(qIdx + 1, 1);
              } else {
                renderMain();
              }
            }, 400);
          });
          btn.addEventListener('keydown', e => { if(["Enter"," "].includes(e.key)) btn.click(); });
          wrap.appendChild(btn);
        });
        return wrap;
      }
      function buildChoice4(q, value) {
        const wrap = document.createElement('div');
        wrap.className = 'choice4-ctn';
        q.answers.forEach((ans, i) => {
          const btn = document.createElement('button');
          btn.className = 'choice4-btn';
          btn.setAttribute('tabindex', '0');
          btn.setAttribute('aria-label', ans.label);
          btn.style.setProperty('--option-color', ans.color);
          btn.innerHTML = `<div class="choice4-emoji">${ans.emoji}</div><div class="choice4-label">${ans.label}</div>`;
          if (value === ans.value) btn.classList.add('selected');
          btn.addEventListener('click', () => { 
            answers[qIdx] = ans.value; 
            btn.classList.add('selected');
            // Auto-advance after short delay for feedback (this is the last question)
            setTimeout(() => {
              showCalculating(answers);
            }, 400);
          });
          btn.addEventListener('keydown', e => { if(["Enter"," "].includes(e.key)) btn.click(); });
          wrap.appendChild(btn);
        });
        return wrap;
      }
      function buildEmojiScale(q, value) {
        const row = document.createElement('div');
        row.className = 'emoji-row';
        row.innerHTML = `<div class='scale-bar'></div><div class='scale-gradient'></div>`;
        q.answers.forEach((ans, i) => {
          const btn = document.createElement('button');
          btn.className = 'emoji-btn';
          btn.setAttribute('tabindex', '0');
          btn.setAttribute('aria-label', ans.label);
          btn.innerHTML = `<span class='emoji-icn'>${ans.emoji}</span><div class='emoji-label'>${ans.label}</div>`;
          if (value === i) btn.classList.add('selected');
          btn.addEventListener('click', () => { answers[qIdx] = i; renderMain(); });
          btn.addEventListener('keydown', e => { if(["Enter"," "].includes(e.key)) btn.click(); });
          row.appendChild(btn);
        });
        return row;
      }
      function buildBinaryChoices(q, value) {
        const wrap = document.createElement('div');
        wrap.className = 'binary-choices';
        q.answers.forEach((ans, i) => {
          const card = document.createElement('div');
          card.className = 'choice-card';
          card.style.setProperty('--choice-color', ans.color);
          card.style.setProperty('--choice-color-weak', ans.color+"19");
          if(value === i) card.classList.add('selected');
          if(value !== null && value !== i) card.classList.add('faded');
          card.setAttribute('tabindex','0');
          card.setAttribute('aria-label', ans.label+", "+ans.desc);
          card.innerHTML = `<span class='choice-icon'>${ans.icon}</span><div class='choice-content'><span class='choice-label'>${ans.label}</span><span class='choice-desc'>${ans.desc}</span></div>`;
          card.addEventListener('click', () => { answers[qIdx] = i; renderMain(); });
          card.addEventListener('keydown', e => { if(["Enter"," "].includes(e.key)) card.click(); });
          wrap.appendChild(card);
        });
        return wrap;
      }
      function buildSliderInput(q, value) {
        const wrap = document.createElement('div');
        wrap.className = 'slider-ctn';
        if (value === null) value = q.initial || 50;
        const badge = document.createElement('div'); badge.className = 'slider-value-badge'; badge.textContent = value + '%'; wrap.appendChild(badge);
        const slider = document.createElement('div'); slider.className = 'energy-slider';
        const fill = document.createElement('div'); fill.className = 'slider-fill'; slider.appendChild(fill);
        const ticks = document.createElement('div'); ticks.className = 'slider-ticks';
        [0.25,0.5,0.75].forEach(frac => { const t = document.createElement('div'); t.className = 'slider-tick'; t.style.left = (frac*100)+"%"; ticks.appendChild(t); });
        slider.appendChild(ticks); wrap.appendChild(slider);
        const thumb = document.createElement('div'); thumb.className = 'slider-thumb'; thumb.setAttribute('tabindex','0'); thumb.setAttribute('role','slider'); thumb.setAttribute('aria-valuenow', value); thumb.setAttribute('aria-valuemin',q.min); thumb.setAttribute('aria-valuemax',q.max); slider.appendChild(thumb);
        const labels = document.createElement('div'); labels.className = 'slider-labels'; labels.innerHTML = `<span>${q.minLabel||q.min}</span><span>${q.maxLabel||q.max}</span>`; wrap.appendChild(labels);
        function setPos(val) {
          let pct = Math.round((val-q.min)/(q.max-q.min)*100);
          fill.style.width = pct + '%';
          let range = slider.offsetWidth-32;
          let px = Math.max(0, Math.min(range, Math.round(pct/100*range)));
          thumb.style.left = px+'px';
          badge.textContent = val+'%';
          answers[qIdx] = val;
        }
        setTimeout(()=>setPos(value),30);
        let dragging = false;
        thumb.addEventListener('mousedown',start); thumb.addEventListener('touchstart',start);
        function start(e) {
          dragging = true;
          badge.classList.add('visible');
          document.body.style.userSelect='none';
          move(e); window.addEventListener('mousemove', move);
          window.addEventListener('mouseup', up);
          window.addEventListener('touchmove', move);
          window.addEventListener('touchend', up);
        }
        function move(e) {
          if(!dragging) return;
          let x = (e.touches ? e.touches[0].clientX : e.clientX) - slider.getBoundingClientRect().left;
          let pct = Math.min(1, Math.max(0, (x-16)/(slider.offsetWidth-32)) );
          let value = Math.round(pct * (q.max-q.min) + q.min);
          setPos(value);
        }
        function up() {
          dragging = false;
          badge.classList.remove('visible');
          document.body.style.userSelect='';
          window.removeEventListener('mousemove', move);
          window.removeEventListener('mouseup', up);
          window.removeEventListener('touchmove', move);
          window.removeEventListener('touchend', up);
          renderMain();
        }
        thumb.addEventListener('keydown', e => { let val = answers[qIdx]||q.initial||50; if(e.key==="ArrowLeft" || e.key==="ArrowDown") { val = Math.max(val-5,q.min); setPos(val); } if(e.key==="ArrowRight" || e.key==="ArrowUp") { val = Math.min(val+5,q.max); setPos(val); } if(["Enter"," "].includes(e.key)) up(); });
        return wrap;
      }
      function buildMotionHeader(q, size = 'sm', paused = false) {
        const container = document.createElement('div');
        container.className = 'question-motion-header';
        container.setAttribute('data-size', size);
        container.setAttribute('data-paused', paused);
        container.setAttribute('role', 'img');
        container.setAttribute('aria-label', q.question || 'Question illustration');
        
        const svgMap = {
          sun: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <radialGradient id="energyGradient">
                <stop offset="0%" stop-color="var(--brand-gold)" stop-opacity="1"/>
                <stop offset="70%" stop-color="var(--brand-orange)" stop-opacity="0.9"/>
                <stop offset="100%" stop-color="var(--brand-pink)" stop-opacity="0.7"/>
              </radialGradient>
            </defs>
            <!-- Organic energy rays -->
            <g class="motion-energy-rays">
              <path d="M50 15 Q48 20, 50 25" stroke="var(--brand-gold)" stroke-width="2.5" fill="none" stroke-linecap="round"/>
              <path d="M72 22 Q68 26, 65 30" stroke="var(--brand-gold)" stroke-width="2.5" fill="none" stroke-linecap="round"/>
              <path d="M85 50 Q80 49, 75 50" stroke="var(--brand-gold)" stroke-width="2.5" fill="none" stroke-linecap="round"/>
              <path d="M72 78 Q68 74, 65 70" stroke="var(--brand-gold)" stroke-width="2.5" fill="none" stroke-linecap="round"/>
              <path d="M50 85 Q48 80, 50 75" stroke="var(--brand-gold)" stroke-width="2.5" fill="none" stroke-linecap="round"/>
              <path d="M28 78 Q32 74, 35 70" stroke="var(--brand-gold)" stroke-width="2.5" fill="none" stroke-linecap="round"/>
              <path d="M15 50 Q20 49, 25 50" stroke="var(--brand-gold)" stroke-width="2.5" fill="none" stroke-linecap="round"/>
              <path d="M28 22 Q32 26, 35 30" stroke="var(--brand-gold)" stroke-width="2.5" fill="none" stroke-linecap="round"/>
            </g>
            <!-- Pulsing core with gradient -->
            <circle class="motion-energy-core" cx="50" cy="50" r="20" fill="url(#energyGradient)"/>
            <!-- Energy sparks -->
            <circle class="motion-energy-spark" cx="50" cy="32" r="3" fill="var(--brand-yellow)" style="animation-delay: 0s"/>
            <circle class="motion-energy-spark" cx="68" cy="50" r="3" fill="var(--brand-yellow)" style="animation-delay: 0.8s"/>
            <circle class="motion-energy-spark" cx="50" cy="68" r="3" fill="var(--brand-yellow)" style="animation-delay: 1.6s"/>
          </svg>`,
          
          wave: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <clipPath id="waveClip"><rect x="0" y="0" width="100" height="100"/></clipPath>
              <linearGradient id="moodGradient1" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="var(--brand-pink)" stop-opacity="0.9"/>
                <stop offset="50%" stop-color="var(--brand-coral)" stop-opacity="0.95"/>
                <stop offset="100%" stop-color="var(--brand-gold)" stop-opacity="0.85"/>
              </linearGradient>
              <linearGradient id="moodGradient2" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="var(--brand-purple)" stop-opacity="0.8"/>
                <stop offset="100%" stop-color="var(--brand-pink)" stop-opacity="0.85"/>
              </linearGradient>
            </defs>
            <g clip-path="url(#waveClip)">
              <path class="motion-mood-wave" d="M-40 45 Q-20 32, 0 45 T40 45 T80 45 T120 45" fill="none" stroke="url(#moodGradient1)" stroke-width="4" stroke-linecap="round" style="animation-delay: 0s"/>
              <path class="motion-mood-wave" d="M-40 55 Q-20 42, 0 55 T40 55 T80 55 T120 55" fill="none" stroke="url(#moodGradient2)" stroke-width="3.5" stroke-linecap="round" style="animation-delay: 0.8s"/>
              <path class="motion-mood-wave" d="M-40 65 Q-20 52, 0 65 T40 65 T80 65 T120 65" fill="none" stroke="var(--brand-blue)" stroke-width="3" stroke-linecap="round" opacity="0.8" style="animation-delay: 1.6s"/>
            </g>
          </svg>`,
          
          lens: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <radialGradient id="focusGradient">
                <stop offset="0%" stop-color="var(--brand-blue)" stop-opacity="0.9"/>
                <stop offset="100%" stop-color="var(--brand-cyan)" stop-opacity="0.7"/>
              </radialGradient>
            </defs>
            <!-- Converging ripples -->
            <circle class="motion-focus-ring" cx="50" cy="50" r="30" fill="none" stroke="var(--brand-blue)" stroke-width="2.5" opacity="0" style="animation-delay: 0s"/>
            <circle class="motion-focus-ring" cx="50" cy="50" r="30" fill="none" stroke="var(--brand-cyan)" stroke-width="2.5" opacity="0" style="animation-delay: 1s"/>
            <circle class="motion-focus-ring" cx="50" cy="50" r="30" fill="none" stroke="var(--brand-purple)" stroke-width="2" opacity="0" style="animation-delay: 2s"/>
            <!-- Center focal point -->
            <circle class="motion-focus-center" cx="50" cy="50" r="14" fill="url(#focusGradient)"/>
            <circle cx="50" cy="50" r="8" fill="var(--brand-blue)" opacity="0.6"/>
          </svg>`,
          
          stack: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <linearGradient id="loadGrad1" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="var(--brand-coral)" stop-opacity="1"/>
                <stop offset="100%" stop-color="var(--brand-pink)" stop-opacity="0.9"/>
              </linearGradient>
              <linearGradient id="loadGrad2" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="var(--brand-orange)" stop-opacity="1"/>
                <stop offset="100%" stop-color="var(--brand-gold)" stop-opacity="0.9"/>
              </linearGradient>
            </defs>
            <!-- Organic stacked elements with curves -->
            <rect class="motion-load-box" x="28" y="62" width="44" height="14" rx="4" fill="url(#loadGrad1)" style="animation-delay: 0s"/>
            <rect class="motion-load-box" x="28" y="44" width="44" height="14" rx="4" fill="url(#loadGrad2)" style="animation-delay: 0.2s"/>
            <rect class="motion-load-box" x="28" y="26" width="44" height="14" rx="4" fill="var(--brand-yellow)" opacity="0.95" style="animation-delay: 0.4s"/>
          </svg>`,
          
          rocket: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <linearGradient id="rocketGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="var(--brand-yellow)" stop-opacity="1"/>
                <stop offset="100%" stop-color="var(--brand-orange)" stop-opacity="0.9"/>
              </linearGradient>
            </defs>
            <g class="motion-motivation-body">
              <!-- Organic rocket shape -->
              <path d="M50 22 Q45 28, 45 35 L45 50 Q45 55, 40 58 L50 53 L60 58 Q55 55, 55 50 L55 35 Q55 28, 50 22 Z" 
                    fill="url(#rocketGrad)" stroke="var(--brand-gold)" stroke-width="1.5"/>
              <circle cx="50" cy="35" r="4" fill="var(--brand-pink)" opacity="0.9"/>
              <ellipse class="motion-motivation-trail" cx="50" cy="62" rx="10" ry="7" fill="var(--brand-orange)" opacity="0.7" style="animation-delay: 0s"/>
              <ellipse class="motion-motivation-trail" cx="50" cy="65" rx="8" ry="5" fill="var(--brand-gold)" opacity="0.6" style="animation-delay: 0.6s"/>
            </g>
          </svg>`,
          
          clock: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <linearGradient id="hourglassGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="var(--brand-gold)" stop-opacity="1"/>
                <stop offset="50%" stop-color="var(--brand-orange)" stop-opacity="0.95"/>
                <stop offset="100%" stop-color="var(--brand-coral)" stop-opacity="0.9"/>
              </linearGradient>
              <linearGradient id="sandGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="var(--brand-yellow)" stop-opacity="1"/>
                <stop offset="100%" stop-color="var(--brand-gold)" stop-opacity="0.95"/>
              </linearGradient>
            </defs>
            
            <!-- Hourglass frame with organic curves -->
            <g class="motion-hourglass-frame">
              <!-- Top bulb -->
              <path d="M35 15 Q30 15, 30 20 L30 35 Q30 42, 35 45 L45 50 Q50 52, 55 50 L65 45 Q70 42, 70 35 L70 20 Q70 15, 65 15 Z" 
                    fill="none" stroke="url(#hourglassGrad)" stroke-width="2.5" stroke-linecap="round"/>
              <!-- Bottom bulb -->
              <path d="M35 85 Q30 85, 30 80 L30 65 Q30 58, 35 55 L45 50 Q50 48, 55 50 L65 55 Q70 58, 70 65 L70 80 Q70 85, 65 85 Z" 
                    fill="none" stroke="url(#hourglassGrad)" stroke-width="2.5" stroke-linecap="round"/>
              <!-- Center neck -->
              <ellipse cx="50" cy="50" rx="4" ry="3" fill="var(--brand-orange)" opacity="0.8"/>
            </g>
            
            <!-- Sand in top chamber (depleting) -->
            <g class="motion-sand-top">
              <ellipse cx="50" cy="30" rx="14" ry="8" fill="url(#sandGrad)" opacity="0.85"/>
              <rect x="36" y="30" width="28" height="12" fill="url(#sandGrad)" opacity="0.85" rx="2"/>
            </g>
            
            <!-- Falling sand particles -->
            <g class="motion-sand-particles">
              <circle class="motion-sand-particle" cx="50" cy="45" r="2" fill="var(--brand-yellow)" style="animation-delay: 0s"/>
              <circle class="motion-sand-particle" cx="49" cy="40" r="1.5" fill="var(--brand-gold)" style="animation-delay: 0.3s"/>
              <circle class="motion-sand-particle" cx="51" cy="42" r="1.5" fill="var(--brand-yellow)" style="animation-delay: 0.6s"/>
              <circle class="motion-sand-particle" cx="50" cy="38" r="1" fill="var(--brand-gold)" style="animation-delay: 0.9s"/>
            </g>
            
            <!-- Sand in bottom chamber (accumulating) -->
            <g class="motion-sand-bottom">
              <ellipse cx="50" cy="75" rx="14" ry="8" fill="url(#sandGrad)" opacity="0.9"/>
              <rect x="36" y="60" width="28" height="15" fill="url(#sandGrad)" opacity="0.9" rx="2"/>
            </g>
            
            <!-- Subtle glow particles around hourglass -->
            <circle class="motion-time-glow" cx="35" cy="30" r="2" fill="var(--brand-pink)" opacity="0.6" style="animation-delay: 0s"/>
            <circle class="motion-time-glow" cx="65" cy="35" r="2" fill="var(--brand-coral)" opacity="0.6" style="animation-delay: 0.5s"/>
            <circle class="motion-time-glow" cx="35" cy="70" r="2" fill="var(--brand-pink)" opacity="0.6" style="animation-delay: 1s"/>
            <circle class="motion-time-glow" cx="65" cy="65" r="2" fill="var(--brand-coral)" opacity="0.6" style="animation-delay: 1.5s"/>
          </svg>`
        };
        
        container.innerHTML = svgMap[q.hero] || svgMap.sun;
        
        // Activate animation after a brief delay
        setTimeout(() => {
          container.classList.add('active');
        }, 50);
        
        return container;
      }
      function showCalculating(answers) {
        // Directly show result with animated reveal
        showStateResult(answers);
      }
      function renderMain() {
        renderProgress();
        cardCtn.innerHTML = '';
        let show = qIdx;
        let prevCard = cardCtn.querySelector('.glass-card.active');
        if(prevCard) { prevCard.classList.remove('active','entering'); prevCard.classList.add('leaving', animDir>0?'prev':'next'); }
        setTimeout(()=>{
          cardCtn.innerHTML = '';
          let c = document.createElement('div'); c.className = 'glass-card active'; const q = questions[show];
          // Add text content first
          c.innerHTML = `<div class='card-indicator'>${q.indicator||''}</div>`+ `<div class='question-txt'>${q.question}</div>`+ `<div class='subtext-txt'>${q.subtext||''}</div>`;
          // Add hero illustration at the beginning
          c.insertBefore(buildMotionHeader(q), c.firstChild);
          let ansVal = answers[show]; 
          if(q.type==='scale5') c.appendChild(buildScale5(q, ansVal)); 
          else if(q.type==='choice4') c.appendChild(buildChoice4(q, ansVal)); 
          else if(q.type==='emoji') c.appendChild(buildEmojiScale(q, ansVal)); 
          else if(q.type==='binary') c.appendChild(buildBinaryChoices(q, ansVal)); 
          else if(q.type==='slider') c.appendChild(buildSliderInput(q, ansVal));
          cardCtn.appendChild(c); setTimeout(()=>{c.classList.add('active')},10);
          c.setAttribute('aria-label', `${q.indicator}: ${q.question}`); c.setAttribute('tabindex','0');
          let ready = ansVal !== null && ansVal !== undefined;
          if(qIdx===questions.length-1) { continueBtnText.textContent = 'Get My Recommendations'; continueBtn.style.width = '200px'; } else { continueBtnText.textContent = 'Continue â†’'; continueBtn.style.width = '140px'; }
          continueBtn.className = 'btn-continue'+(ready?' enabled':'');
          continueBtn.disabled = !ready;
          continueBtn.setAttribute('aria-disabled', (!ready).toString());
          // Show back button from second question onwards, or always when editing
          if(qIdx > 0 || cancelCallback) {
            backBtn.classList.add('visible');
          } else {
            backBtn.classList.remove('visible');
          }
        }, animDir? 140: 0);
      }
      function goTo(idx, dir) {
        if(idx < 0 || idx > questions.length) return; animDir = dir;
        if(idx === questions.length) { showStateResult(answers); } else { qIdx = idx; renderMain(); }
      }
      continueBtn.addEventListener('click', () => { let ready = answers[qIdx]!==null && answers[qIdx]!==undefined; if(!ready) return; continueBtnText.innerHTML = `<span class='spinner'></span>`; continueBtn.disabled = true; setTimeout(() => { continueBtn.disabled = false; goTo(qIdx+1,1); }, 600); });
      backBtn.addEventListener('click', () => { 
        if(cancelCallback) {
          // When editing from mood, always go back to mood
          cancelCallback();
        } else if(qIdx > 0) {
          // Normal flow: go to previous question
          goTo(qIdx-1, -1);
        }
      });
      renderMain();
    }
    // ---- State Detection Result screen (single function, re-entrant) ----
    function showStateResult(answers) {
      // Scroll to top on page load
      setTimeout(() => scrollToTop(), 100);
      
      // Reset header title
      const appHeader = document.querySelector('.app-header h1');
      if (appHeader) appHeader.textContent = 'Daily Check-in';
      
      // Normalize raw answers (multiply by 10)
      const q_energy = answers[0] * 10;      // Q1: 0,2,5,8,10 â†’ 0,20,50,80,100
      const q_mood = answers[1] * 10;        // Q2: 0,2,5,8,10 â†’ 0,20,50,80,100
      const q_focus = answers[2] * 10;       // Q3: 0,2,5,8,10 â†’ 0,20,50,80,100
      const q_load = answers[3] * 10;        // Q4: 0,2,5,8,10 â†’ 0,20,50,80,100
      const q_motivation = answers[4] * 10;  // Q5: 0,2,5,8,10 â†’ 0,20,50,80,100
      const q_pressure = answers[5];         // Q6: 10,50,85,100 (already normalized)
      
      // Compute indices (0-100, clamped and rounded)
      const FocusIndex = Math.round(Math.min(100, Math.max(0, 0.5 * q_focus + 0.25 * (100 - q_load) + 0.25 * q_energy)));
      const CreativityIndex = Math.round(Math.min(100, Math.max(0, 0.5 * q_mood + 0.25 * q_energy + 0.25 * (100 - q_pressure))));
      const ReadinessIndex = Math.round(Math.min(100, Math.max(0, 0.6 * q_motivation + 0.2 * (100 - q_load) + 0.2 * q_energy)));
      const StrainIndex = Math.round(Math.min(100, Math.max(0, 0.5 * q_load + 0.3 * q_pressure + 0.2 * (100 - q_mood))));
      
      // Infer vibe (one of five: focus, creative, recovery, overloaded, collaborative)
      let vibe = null;
      
      // Focus: FocusIndex â‰¥ 70 and StrainIndex â‰¤ 60 OR (q_focus â‰¥ 70 and q_load â‰¤ 55)
      if ((FocusIndex >= 70 && StrainIndex <= 60) || (q_focus >= 70 && q_load <= 55)) {
        vibe = 'focus';
      }
      // Creative: CreativityIndex â‰¥ 70 and StrainIndex â‰¤ 65
      else if (CreativityIndex >= 70 && StrainIndex <= 65) {
        vibe = 'creative';
      }
      // Recovery: q_energy â‰¤ 40 OR ReadinessIndex â‰¤ 45
      else if (q_energy <= 40 || ReadinessIndex <= 45) {
        vibe = 'recovery';
      }
      // Overloaded: StrainIndex â‰¥ 70 OR q_load â‰¥ 70
      else if (StrainIndex >= 70 || q_load >= 70) {
        vibe = 'overloaded';
      }
      // Collaborative: ReadinessIndex â‰¥ 60 AND q_mood â‰¥ 60 AND StrainIndex â‰¤ 60 AND FocusIndex between 45-70
      else if (ReadinessIndex >= 60 && q_mood >= 60 && StrainIndex <= 60 && FocusIndex >= 45 && FocusIndex <= 70) {
        vibe = 'collaborative';
      }
      // Default fallback (if no vibe matches, use recovery as safe default)
      else {
        vibe = 'recovery';
      }
      
      const vibeConfig = VIBE_CONFIG[vibe];
      const mode = vibe;
      let energy = q_energy;
      energy = Math.min(100, Math.max(0, energy));
      const desc = vibeConfig.summary;
      const tip = vibeConfig.tip;
      
      // Vibe-specific colors and gradients
      const vibeColors = {
        focus: { gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', glowColor: 'rgba(102, 126, 234, 0.5)' },
        creative: { gradient: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', glowColor: 'rgba(245, 87, 108, 0.5)' },
        recovery: { gradient: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)', glowColor: 'rgba(168, 237, 234, 0.5)' },
        overloaded: { gradient: 'linear-gradient(135deg, #ff6b6b 0%, #feca57 100%)', glowColor: 'rgba(255, 107, 107, 0.5)' },
        collaborative: { gradient: 'linear-gradient(135deg, #a8b0c8 0%, #c3cfe2 100%)', glowColor: 'rgba(168, 176, 200, 0.5)' }
      };
      
      const vibeColor = vibeColors[vibe];
      
      // Format description with line breaks for rhythm
      const formattedDesc = desc.replace(/â€”/g, 'â€”<br>').replace(/\./g, '.<br>').replace(/<br>$/, '');
      
      const c = document.getElementById('router-ctn');
      c.innerHTML = `<div class="state-screen active">
        <div class="result-reveal-container">
          <div class="result-orb" id="resultOrb">
            <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <radialGradient id="circleGrad1" cx="50%" cy="50%">
                  <stop offset="0%" style="stop-color:#f093fb;stop-opacity:1" />
                  <stop offset="60%" style="stop-color:#ff6b6b;stop-opacity:0.9" />
                  <stop offset="100%" style="stop-color:#764ba2;stop-opacity:0.8" />
                </radialGradient>
                <radialGradient id="circleGrad2" cx="50%" cy="50%">
                  <stop offset="0%" style="stop-color:#f4e87c;stop-opacity:0.85" />
                  <stop offset="60%" style="stop-color:#fbbf24;stop-opacity:0.8" />
                  <stop offset="100%" style="stop-color:#ff9aa2;stop-opacity:0.7" />
                </radialGradient>
                <radialGradient id="circleGrad3" cx="50%" cy="50%">
                  <stop offset="0%" style="stop-color:#ffb4a8;stop-opacity:0.75" />
                  <stop offset="60%" style="stop-color:#ffd54f;stop-opacity:0.7" />
                  <stop offset="100%" style="stop-color:#89cff0;stop-opacity:0.65" />
                </radialGradient>
              </defs>
              <circle class="result-blob-layer1" cx="50" cy="50" r="32" fill="url(#circleGrad1)" />
              <circle class="result-blob-layer2" cx="50" cy="50" r="26" fill="url(#circleGrad2)" />
              <circle class="result-blob-layer3" cx="50" cy="50" r="20" fill="url(#circleGrad3)" />
            </svg>
          </div>
          <div class="result-vibe-title" id="vibeTitle">You're in ${vibeConfig.label} Mode</div>
          <div class="result-vibe-desc" id="vibeDesc">${formattedDesc}</div>
          <button class="result-cta-btn" id="ctaBtn">See My Smart Plan</button>
        </div>
      </div>`;
      
      // Animated reveal sequence
      const orb = document.getElementById('resultOrb');
      const vibeTitle = document.getElementById('vibeTitle');
      const vibeDesc = document.getElementById('vibeDesc');
      const ctaBtn = document.getElementById('ctaBtn');
      
      // Step 1: Show orb (0-1000ms)
      setTimeout(() => {
        orb.classList.add('active');
      }, 100);
      
      // Step 2: Morph orb, reveal title (1000ms)
      setTimeout(() => {
        orb.classList.add('morphed');
        setTimeout(() => {
          vibeTitle.classList.add('active');
        }, 200);
      }, 1000);
      
      // Step 3: Show description (1800ms)
      setTimeout(() => {
        vibeDesc.classList.add('active');
      }, 1800);
      
      // Step 4: Show CTA button (2400ms)
      setTimeout(() => {
        ctaBtn.classList.add('active');
      }, 2400);
      
      // Store answers in localStorage for mood screen
      const today = new Date().toLocaleDateString();
      localStorage.setItem('mood_answers_' + today, JSON.stringify(answers));
      localStorage.setItem('mood_mode_' + today, mode);
      localStorage.setItem('mood_energy_' + today, energy);
      
      // Store tip for task screen
      ctaBtn.onclick = () => showTaskRecommendations(mode, energy, tip);
    }
    // ---- Task Recommendation Screen ----
    const SAMPLE_TASKS = {
      focus: [
        {id:'t1',title:'Complete quarterly financial analysis',category:'focused',duration:120,priority:1,icon:'ðŸ“Š',reasoning:'Perfect for your sharp focus right now ðŸŽ¯',matchScore:94},
        {id:'t2',title:'Review and sign off on client contracts',category:'focused',duration:45,priority:1,icon:'âš¡',reasoning:'Matches your execution mode âœ¨',matchScore:91},
        {id:'t3',title:'Update project documentation',category:'focused',duration:60,priority:2,icon:'ðŸ“',reasoning:'Deep work matches your focus state',matchScore:87},
        {id:'t4',title:'Debug critical production issue',category:'focused',duration:90,priority:1,icon:'ðŸ›',reasoning:'Your concentration is ideal for debugging',matchScore:89},
        {id:'t5',title:'Organize workspace and files',category:'flexible',duration:30,priority:3,icon:'ðŸ”„',reasoning:'Better when energy is lower',matchScore:55},
      ],
      creative: [
        {id:'t1',title:'Brainstorm Q4 marketing campaign ideas',category:'creative',duration:45,priority:1,icon:'ðŸ’¡',reasoning:'Perfect for your creative energy spike ðŸ“ˆ',matchScore:92},
        {id:'t2',title:'Write draft for client proposal',category:'creative',duration:60,priority:1,icon:'âœï¸',reasoning:'Your mood supports creative writing âœ¨',matchScore:88},
        {id:'t3',title:'Design mockups for homepage refresh',category:'creative',duration:90,priority:2,icon:'ðŸŽ¨',reasoning:'Ideal for divergent thinking',matchScore:85},
        {id:'t4',title:'Develop product strategy',category:'creative',duration:75,priority:1,icon:'ðŸš€',reasoning:'Strategy work fits your creative state',matchScore:86},
        {id:'t5',title:'Review competitor marketing strategies',category:'focused',duration:30,priority:2,icon:'ðŸ“Š',reasoning:'Better when in focus mode',matchScore:60},
      ],
      recovery: [
        {id:'t1',title:'Respond to routine emails',category:'flexible',duration:20,priority:2,icon:'ðŸ“§',reasoning:'Low-stakes task perfect for current energy',matchScore:85},
        {id:'t2',title:'Organize digital files',category:'flexible',duration:30,priority:3,icon:'ðŸ“',reasoning:'Simple organizing builds momentum',matchScore:82},
        {id:'t3',title:'Read industry newsletter',category:'flexible',duration:15,priority:3,icon:'ðŸ“°',reasoning:'Light reading fits your energy level',matchScore:80},
        {id:'t4',title:'Take a 15-minute walk',category:'wellness',duration:15,priority:2,icon:'ðŸƒ',reasoning:'Movement will help restore energy',matchScore:88},
        {id:'t5',title:'Update expense report',category:'flexible',duration:25,priority:2,icon:'ðŸ’°',reasoning:'Simple admin task, low cognitive load',matchScore:78},
      ],
      overloaded: [
        {id:'t1',title:'List all urgent priorities',category:'flexible',duration:15,priority:1,icon:'ðŸ“‹',reasoning:'Triage first to reduce overwhelm',matchScore:90},
        {id:'t2',title:'Delegate 2 non-critical tasks',category:'flexible',duration:20,priority:1,icon:'ðŸ¤',reasoning:'Lighten your load before starting work',matchScore:88},
        {id:'t3',title:'Cancel or postpone one meeting',category:'flexible',duration:10,priority:1,icon:'ðŸ“…',reasoning:'Create breathing room in your schedule',matchScore:85},
        {id:'t4',title:'Take 5 deep breaths',category:'wellness',duration:5,priority:1,icon:'ðŸ§˜',reasoning:'Quick reset to clear mental fog',matchScore:92},
        {id:'t5',title:'Write down 3 things to let go of',category:'flexible',duration:10,priority:2,icon:'âœ‚ï¸',reasoning:'De-scope to manage cognitive load',matchScore:87},
      ],
      collaborative: [
        {id:'t1',title:'Host team standup meeting',category:'flexible',duration:30,priority:1,icon:'ðŸ‘¥',reasoning:'Your mood and readiness are perfect for leading',matchScore:91},
        {id:'t2',title:'Review teammate\'s code',category:'focused',duration:45,priority:2,icon:'ðŸ‘€',reasoning:'Good balance of focus and communication',matchScore:86},
        {id:'t3',title:'Provide design feedback to team',category:'creative',duration:30,priority:2,icon:'ðŸ’¬',reasoning:'Collaborative creativity fits your state',matchScore:84},
        {id:'t4',title:'Conduct 1-on-1 check-in',category:'flexible',duration:30,priority:1,icon:'ðŸ¤',reasoning:'Ideal time for meaningful conversation',matchScore:89},
        {id:'t5',title:'Plan next sprint with team',category:'flexible',duration:60,priority:2,icon:'ðŸ“Š',reasoning:'Alignment work matches your readiness',matchScore:82},
      ]
    }
    function getGreeting() {
      const h = new Date().getHours();
      if(h>=5&&h<12) return 'Good morning';
      if(h>=12&&h<17) return 'Good afternoon';
      if(h>=17&&h<21) return 'Good evening';
      return 'Working late';
    }
    function getCurrentTime() {
      const d = new Date();
      let h = d.getHours(); let m = d.getMinutes();
      const ampm = h>=12?'PM':'AM';
      h = h%12; if(h===0) h=12;
      return `${h}:${m.toString().padStart(2,'0')} ${ampm}`;
    }
    function showTaskRecommendations(mode, energy, tip) {
      // Scroll to top on page load
      setTimeout(() => scrollToTop(), 100);
      
      // Update header title
      const appHeader = document.querySelector('.app-header h1');
      if (appHeader) appHeader.textContent = 'My Smart Plan';
      
      const vibeConfig = VIBE_CONFIG[mode] || VIBE_CONFIG.recovery;
      const tasks = SAMPLE_TASKS[mode] || SAMPLE_TASKS.recovery;
      const recommended = tasks.filter(t=>t.matchScore>=80).slice(0,3);
      const other = tasks.filter(t=>t.matchScore<80).slice(0,4);
      const greeting = getGreeting();
      const currentTime = getCurrentTime();
      const energyLabel = energy>=75?'High':energy>=50?'Good':energy>=25?'Moderate':'Low';
      const modeLabel = vibeConfig.label;
      const modeIcon = vibeConfig.icon;
      const modeColor = mode==='creative'?'#ffb4a8':mode==='focus'?'#89cff0':mode==='recovery'?'#b5e7a0':mode==='overloaded'?'#ff6b6b':'#f4e87c';
      const currentDate = new Date();
      const dateStr = formatDate(currentDate);
      const c = document.getElementById('router-ctn');
      c.innerHTML = `<div class="task-screen active">
        <div class="task-header">
          <div class="task-header-row">
            <div class="task-state-summary"><span class="state-name" style="color:${modeColor}">${modeIcon} ${modeLabel}</span> â€¢ ${energyLabel} energy</div>
            <div class="task-avatar">ðŸ‘¤</div>
          </div>
          <div class="view-tabs">
            <button class="view-tab-btn active" data-view="list">List</button>
            <button class="view-tab-btn" data-view="calendar" id="calendarViewBtn">Calendar</button>
          </div>
          <div class="plan-day-selector">
            <button class="plan-day-btn" id="prevDayBtn">â€¹</button>
            <div class="plan-day-label">${dateStr}</div>
            <button class="plan-day-btn" id="nextDayBtn">â€º</button>
          </div>
        </div>
        <div class="task-content">
          ${tip ? `<div class="task-tip-banner">ðŸ’¡ ${tip}</div>` : ''}
          <div class="task-section-header">
            <div class="task-section-title">âœ¨ Recommended now</div>
            <button class="task-info-btn" title="Based on your ${modeLabel} state and ${energy}% energy">â„¹</button>
          </div>
          ${recommended.map((t,i)=>`
            <div class="task-card ${t.category}" style="opacity:0; transform:translateX(30px);">
              <div class="task-color-strip"></div>
              <div class="task-icon-ctn">
                <div class="task-icon-circle">${t.icon}</div>
              </div>
              <div class="task-card-content">
                <div class="task-title">${t.title}</div>
                <div class="task-metadata">${t.duration} min â€¢ ${t.priority===1?'Priority 1':t.priority===2?'Priority 2':'Priority 3'}</div>
                <div class="task-ai-reasoning">${t.reasoning}</div>
              </div>
              <div class="task-action-ctn">
                <button class="task-start-btn">Start</button>
              </div>
            </div>
          `).join('')}
          <div class="task-divider"></div>
          <div class="task-section-header">
            <div class="task-section-title">Other priorities</div>
          </div>
          ${other.map((t,i)=>`
            <div class="task-card ${t.category} compact-task-card" style="opacity:0; transform:translateX(20px);">
              <div class="task-color-strip" style="width:4px;"></div>
              <div class="task-icon-ctn">
                <div class="task-icon-circle">${t.icon}</div>
              </div>
              <div class="task-card-content">
                <div class="task-title">${t.title}</div>
                <div class="task-metadata">${t.duration} min â€¢ ${t.priority===1?'High':t.priority===2?'Medium':'Low'} priority</div>
              </div>
              <div class="task-action-ctn">
                <div class="task-checkbox" data-task-id="${t.id}"></div>
              </div>
            </div>
          `).join('')}
        </div>
        <div class="bottom-tab-bar">
          <button class="tab-btn active" data-tab="tasks">
            <span class="tab-icon">ðŸ“‹</span>
            <span class="tab-label">Tasks</span>
          </button>
          <button class="tab-btn" data-tab="mood">
            <span class="tab-icon">ðŸŽ­</span>
            <span class="tab-label">Mood</span>
          </button>
          <button class="tab-btn" data-tab="tips">
            <span class="tab-icon">ðŸ’¡</span>
            <span class="tab-label">Tips</span>
          </button>
          <button class="tab-btn" data-tab="profile">
            <span class="tab-icon">ðŸ‘¤</span>
            <span class="tab-label">Profile</span>
          </button>
        </div>
      </div>`;
      // Animate cards in with stagger
      setTimeout(()=>{
        const cards = c.querySelectorAll('.task-card');
        cards.forEach((card,i)=>{
          setTimeout(()=>{
            card.style.transition='opacity .3s ease-out, transform .3s cubic-bezier(.22,1,.36,1)';
            card.style.opacity='1';
            card.style.transform='translateX(0)';
          },100 + i*100);
        });
      },300);
      // Handle back button
      const backBtn = c.querySelector('#taskBackBtn');
      if(backBtn) {
        backBtn.onclick = () => {
          // Reconstruct answers from mode and energy for state result
          const modeIdx = mode==='creative'?0:1;
          const answers = [null, modeIdx, energy, null];
          showStateResult(answers);
        };
      }
      // Handle task actions
      c.querySelectorAll('.task-start-btn').forEach(btn=>{
        btn.onclick=(e)=>{
          e.stopPropagation();
          const card=btn.closest('.task-card');
          alert(`Starting: ${card.querySelector('.task-title').textContent}`);
        };
      });
      c.querySelectorAll('.task-card').forEach(card=>{
        card.onclick=()=>{
          const title=card.querySelector('.task-title').textContent;
          alert(`Task details: ${title}\n\nFeature: Expandable card details coming soon!`);
        };
      });
      // Handle checkboxes
      c.querySelectorAll('.task-checkbox').forEach(cb=>{
        cb.onclick=(e)=>{
          e.stopPropagation();
          cb.classList.toggle('checked');
          const card=cb.closest('.task-card');
          if(cb.classList.contains('checked')){
            card.classList.add('completed');
            setTimeout(()=>{
              card.style.transition='opacity .5s, transform .5s';
              card.style.opacity='0';
              card.style.transform='translateX(-100px)';
              setTimeout(()=>card.remove(),500);
            },500);
          }
        };
      });
      // Timeline view button removed - access via tab switcher instead
      // Handle view tab buttons
      const calendarViewBtn = c.querySelector('#calendarViewBtn');
      if(calendarViewBtn) {
        calendarViewBtn.onclick = () => {
          const content = c.querySelector('.task-content');
          if (content) {
            content.style.opacity = '0';
            setTimeout(() => {
              scrollToTop(true);
              showTimelineView(mode, energy);
            }, 180);
          } else {
            showTimelineView(mode, energy);
          }
        };
      }
      
      // Handle day selector buttons
      const prevDayBtn = c.querySelector('#prevDayBtn');
      const nextDayBtn = c.querySelector('#nextDayBtn');
      if (prevDayBtn) prevDayBtn.onclick = () => alert('Previous day feature coming soon');
      if (nextDayBtn) nextDayBtn.onclick = () => alert('Next day feature coming soon');
      
      // Handle tab navigation
      c.querySelectorAll('.tab-btn').forEach(btn=>{
        btn.onclick = () => {
          const tab = btn.dataset.tab;
          if(tab !== 'tasks') {
            c.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if(tab === 'mood') showMoodScreen(mode, energy);
            else if(tab === 'tips') showTipsScreen(mode, energy);
            else if(tab === 'profile') showProfileScreen();
          }
        };
      });
    }
    // ---- Mood Screen ----
    function showMoodScreen(mode, energy) {
      // Scroll to top on page load
      setTimeout(() => scrollToTop(), 100);
      
      // Update header title
      const appHeader = document.querySelector('.app-header h1');
      if (appHeader) appHeader.textContent = 'Today\'s Mood';
      
      const c = document.getElementById('router-ctn');
      const today = new Date().toLocaleDateString();
      
      // Get stored answers or use placeholder
      const storedAnswers = JSON.parse(localStorage.getItem('mood_answers_' + today) || 'null');
      
      // Map raw values (0,2,5,8,10) to option labels
      const valueToOptionIndex = {0: 0, 2: 1, 5: 2, 8: 3, 10: 4};
      const pressureValueToIndex = {10: 0, 50: 1, 85: 2, 100: 3};
      
      const questions = [
        {label: 'Energy', value: storedAnswers ? storedAnswers[0] : null, options: ['Exhausted', 'Very Low', 'Okay', 'High', 'Sharp']},
        {label: 'Mood', value: storedAnswers ? storedAnswers[1] : null, options: ['Low', 'Flat', 'Neutral', 'Upbeat', 'Elevated']},
        {label: 'Focus', value: storedAnswers ? storedAnswers[2] : null, options: ['Very Distracted', 'Scattered', 'Average', 'Focused', 'Laser-Focused']},
        {label: 'Mental Load', value: storedAnswers ? storedAnswers[3] : null, options: ['Clear', 'Light', 'Manageable', 'Heavy', 'Overloaded']},
        {label: 'Motivation', value: storedAnswers ? storedAnswers[4] : null, options: ['Stuck', 'Low', 'Willing', 'Ready', 'Eager']},
        {label: 'Time Pressure', value: storedAnswers ? storedAnswers[5] : null, options: ['Plenty of time', 'Some pressure', 'Urgent', 'Critical']}
      ];
      
      // Get display text for each answer
      function getAnswerText(q, i) {
        if (q.value === null || q.value === undefined) return 'Not answered yet';
        if (i === 5) {
          // Time pressure question (Q6)
          const idx = pressureValueToIndex[q.value];
          return q.options[idx] || 'Not answered';
        } else {
          // Q1-Q5 (scale questions)
          const idx = valueToOptionIndex[q.value];
          return q.options[idx] || 'Not answered';
        }
      }
      
      c.innerHTML = `<div class="task-screen active">
        <div class="task-header">
          <div class="task-header-row">
            <div class="task-state-summary">My Daily Mood</div>
            <button class="edit-mood-btn">Edit</button>
          </div>
        </div>
        <div class="task-content">
          <div class="mood-date-section">
            <h3>Today - ${new Date().toLocaleDateString('en-US', {weekday: 'long', month: 'short', day: 'numeric'})}</h3>
          </div>
          <div class="mood-answers-section">
            ${questions.map((q, i) => `
              <div class="mood-answer-item">
                <div class="mood-label">${q.label}</div>
                <div class="mood-value">${getAnswerText(q, i)}</div>
              </div>
            `).join('')}
          </div>
          <div class="mood-history-section">
            <h3>Previous Days</h3>
            <div class="mood-history-list">
              <div class="mood-history-item">
                <div class="history-date">Yesterday</div>
                <div class="history-summary">ðŸŽ¯ Focus Mode â€¢ High energy</div>
              </div>
              <div class="mood-history-item">
                <div class="history-date">2 days ago</div>
                <div class="history-summary">ðŸŒˆ Creative Mode â€¢ Good energy</div>
              </div>
              <div class="mood-history-item">
                <div class="history-date">3 days ago</div>
                <div class="history-summary">ðŸŒ¿ Recovery Mode â€¢ Moderate energy</div>
              </div>
            </div>
          </div>
        </div>
        <div class="bottom-tab-bar">
          <button class="tab-btn" data-tab="tasks">
            <span class="tab-icon">ðŸ“‹</span>
            <span class="tab-label">Tasks</span>
          </button>
          <button class="tab-btn active" data-tab="mood">
            <span class="tab-icon">ðŸŽ­</span>
            <span class="tab-label">Mood</span>
          </button>
          <button class="tab-btn" data-tab="tips">
            <span class="tab-icon">ðŸ’¡</span>
            <span class="tab-label">Tips</span>
          </button>
          <button class="tab-btn" data-tab="profile">
            <span class="tab-icon">ðŸ‘¤</span>
            <span class="tab-label">Profile</span>
          </button>
        </div>
      </div>`;
      
      // Handle edit button
      c.querySelector('.edit-mood-btn').onclick = () => {
        renderCheckin(() => showMoodScreen(mode, energy));
      };
      
      // Handle tab navigation
      c.querySelectorAll('.tab-btn').forEach(btn=>{
        btn.onclick = () => {
          const tab = btn.dataset.tab;
          if(tab !== 'mood') {
            if(tab === 'tasks') showTaskRecommendations(mode, energy, '');
            else if(tab === 'tips') showTipsScreen(mode, energy);
            else if(tab === 'profile') showProfileScreen();
          }
        };
      });
    }
    // ---- Tips Screen ----
    function showTipsScreen(mode, energy) {
      // Scroll to top on page load
      setTimeout(() => scrollToTop(), 100);
      
      // Update header title
      const appHeader = document.querySelector('.app-header h1');
      if (appHeader) appHeader.textContent = 'Daily Tips';
      
      const vibeConfig = VIBE_CONFIG[mode] || VIBE_CONFIG.recovery;
      const c = document.getElementById('router-ctn');
      
      c.innerHTML = `<div class="task-screen active">
        <div class="task-header">
          <div class="task-header-row">
            <div class="task-state-summary">Tips & Insights</div>
            <div class="task-avatar">ðŸ’¡</div>
          </div>
        </div>
        <div class="task-content">
          <div class="tip-card">
            <div class="tip-icon">ðŸŽ¯</div>
            <div class="tip-title">Your Current State: ${vibeConfig.label}</div>
            <div class="tip-desc">${vibeConfig.tip}</div>
          </div>
          <div class="tip-card">
            <div class="tip-icon">âš¡</div>
            <div class="tip-title">Energy Optimization</div>
            <div class="tip-desc">Your energy is ${energy >= 75 ? 'high' : energy >= 50 ? 'good' : energy >= 25 ? 'moderate' : 'low'}. ${energy >= 60 ? 'Great time for deep work!' : 'Consider lighter tasks or a quick break.'}</div>
          </div>
          <div class="tip-card">
            <div class="tip-icon">ðŸ§ </div>
            <div class="tip-title">Productivity Pattern</div>
            <div class="tip-desc">You tend to be most productive during ${vibeConfig.label} mode. Schedule similar tasks for this time.</div>
          </div>
          <div class="tip-card">
            <div class="tip-icon">ðŸŽ¨</div>
            <div class="tip-title">Best Activities</div>
            <div class="tip-desc">${vibeConfig.activities.join(', ')}</div>
          </div>
        </div>
        <div class="bottom-tab-bar">
          <button class="tab-btn" data-tab="tasks">
            <span class="tab-icon">ðŸ“‹</span>
            <span class="tab-label">Tasks</span>
          </button>
          <button class="tab-btn" data-tab="mood">
            <span class="tab-icon">ðŸŽ­</span>
            <span class="tab-label">Mood</span>
          </button>
          <button class="tab-btn active" data-tab="tips">
            <span class="tab-icon">ðŸ’¡</span>
            <span class="tab-label">Tips</span>
          </button>
          <button class="tab-btn" data-tab="profile">
            <span class="tab-icon">ðŸ‘¤</span>
            <span class="tab-label">Profile</span>
          </button>
        </div>
      </div>`;
      
      // Handle tab navigation
      c.querySelectorAll('.tab-btn').forEach(btn=>{
        btn.onclick = () => {
          const tab = btn.dataset.tab;
          if(tab !== 'tips') {
            if(tab === 'tasks') showTaskRecommendations(mode, energy, '');
            else if(tab === 'mood') showMoodScreen(mode, energy);
            else if(tab === 'profile') showProfileScreen();
          }
        };
      });
    }
    // ---- Profile Screen ----
    function showProfileScreen() {
      // Scroll to top on page load
      setTimeout(() => scrollToTop(), 100);
      
      // Update header title
      const appHeader = document.querySelector('.app-header h1');
      if (appHeader) appHeader.textContent = 'Profile';
      
      const c = document.getElementById('router-ctn');
      
      c.innerHTML = `<div class="task-screen active">
        <div class="task-header">
          <div class="task-header-row">
            <div class="task-state-summary">Account</div>
            <div class="task-avatar">ðŸ‘¤</div>
          </div>
        </div>
        <div class="task-content">
          <div class="profile-section">
            <div class="profile-avatar-large">ðŸ‘¤</div>
            <div class="profile-name">User Name</div>
            <div class="profile-email">user@example.com</div>
          </div>
          <div class="profile-info-section">
            <h3>Account Information</h3>
            <div class="profile-info-item">
              <div class="info-label">Full Name</div>
              <div class="info-value">John Doe</div>
            </div>
            <div class="profile-info-item">
              <div class="info-label">Email</div>
              <div class="info-value">user@example.com</div>
            </div>
            <div class="profile-info-item">
              <div class="info-label">Member Since</div>
              <div class="info-value">January 2025</div>
            </div>
            <div class="profile-info-item">
              <div class="info-label">Check-ins</div>
              <div class="info-value">23 days</div>
            </div>
          </div>
          <div class="profile-info-section">
            <h3>Preferences</h3>
            <div class="profile-info-item">
              <div class="info-label">Notifications</div>
              <div class="info-value">Enabled</div>
            </div>
            <div class="profile-info-item">
              <div class="info-label">Theme</div>
              <div class="info-value">Dark</div>
            </div>
          </div>
          <button class="action-btn" style="margin-top: 24px; width: 100%; max-width: 358px;">Edit Profile</button>
          <button class="secondary-btn" style="margin-top: 12px; width: 100%; max-width: 358px;">Sign Out</button>
        </div>
        <div class="bottom-tab-bar">
          <button class="tab-btn" data-tab="tasks">
            <span class="tab-icon">ðŸ“‹</span>
            <span class="tab-label">Tasks</span>
          </button>
          <button class="tab-btn" data-tab="mood">
            <span class="tab-icon">ðŸŽ­</span>
            <span class="tab-label">Mood</span>
          </button>
          <button class="tab-btn" data-tab="tips">
            <span class="tab-icon">ðŸ’¡</span>
            <span class="tab-label">Tips</span>
          </button>
          <button class="tab-btn active" data-tab="profile">
            <span class="tab-icon">ðŸ‘¤</span>
            <span class="tab-label">Profile</span>
          </button>
        </div>
      </div>`;
      
      // Handle tab navigation
      c.querySelectorAll('.tab-btn').forEach(btn=>{
        btn.onclick = () => {
          const tab = btn.dataset.tab;
          if(tab !== 'profile') {
            if(tab === 'tasks') {
              const mode = 'recovery';
              const energy = 50;
              showTaskRecommendations(mode, energy, '');
            }
            else if(tab === 'mood') showMoodScreen('recovery', 50);
            else if(tab === 'tips') showTipsScreen('recovery', 50);
          }
        };
      });
    }
    // ---- Timeline View Screen ----
    const SAMPLE_TIMELINE_TASKS = [
      {id:'t1',title:'Morning Routine',category:'wellness',startTime:480,duration:60,status:'scheduled'}, // 8am
      {id:'t2',title:'Brainstorm Q4 Campaign',category:'creative',startTime:600,duration:90,status:'scheduled'}, // 10am
      {id:'t3',title:'Client Proposal Draft',category:'creative',startTime:780,duration:60,status:'scheduled'}, // 1pm
      {id:'t4',title:'Team Standup',category:'flexible',startTime:840,duration:30,status:'scheduled'}, // 2pm
      {id:'t5',title:'Financial Analysis',category:'focused',startTime:960,duration:120,status:'scheduled'}, // 4pm
      {id:'t6',title:'Evening Walk',category:'wellness',startTime:1080,duration:30,status:'scheduled'}, // 6pm
    ];
    function minutesToPixels(min) { return Math.round(min / 60 * 100); }
    function timeToMinutes(hour,min) { return hour*60 + min; }
    function formatTime(hour) {
      const ampm = hour >= 12 ? 'pm' : 'am';
      const h = hour % 12 || 12;
      return h + ampm;
    }
    function formatDate(date) {
      const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
      const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
      const d = date || new Date();
      const dayName = days[d.getDay()];
      const month = months[d.getMonth()];
      const day = d.getDate();
      const isToday = d.toDateString() === new Date().toDateString();
      return isToday ? `Today, ${month} ${day}` : `${dayName}, ${month} ${day}`;
    }
    function getCurrentTimePosition() {
      const now = new Date();
      const hour = now.getHours();
      const min = now.getMinutes();
      return timeToMinutes(hour, min);
    }
    function showTimelineView(mode, energy) {
      // Scroll to top on page load
      setTimeout(() => scrollToTop(), 100);
      
      const vibeConfig = VIBE_CONFIG[mode] || VIBE_CONFIG.recovery;
      const tasks = SAMPLE_TIMELINE_TASKS.map(t=>({...t}));
      const currentDate = new Date();
      const dateStr = formatDate(currentDate);
      const energyLabel = energy>=75?'High':energy>=50?'Good':energy>=25?'Moderate':'Low';
      const modeLabel = vibeConfig.label;
      const modeIcon = vibeConfig.icon;
      const modeColor = mode==='creative'?'#ffb4a8':mode==='focus'?'#89cff0':mode==='recovery'?'#b5e7a0':mode==='overloaded'?'#ff6b6b':'#f4e87c';
      const currentTime = getCurrentTimePosition();
      const startHour = 6;
      const endHour = 23;
      const hoursVisible = endHour - startHour;
      const timelineHeight = hoursVisible * 100;
      const c = document.getElementById('router-ctn');
      c.innerHTML = `<div class="timeline-screen active">
        <div class="timeline-header">
          <div class="task-header-row">
            <div class="task-state-summary"><span class="state-name" style="color:${modeColor}">${modeIcon} ${modeLabel}</span> â€¢ ${energyLabel} energy</div>
            <div class="task-avatar">ðŸ‘¤</div>
          </div>
          <div class="view-tabs">
            <button class="view-tab-btn" data-view="list" id="listViewBtn">List</button>
            <button class="view-tab-btn active" data-view="calendar">Calendar</button>
          </div>
          <div class="plan-day-selector">
            <button class="plan-day-btn" id="prevDayBtnCal">â€¹</button>
            <div class="plan-day-label">${dateStr}</div>
            <button class="plan-day-btn" id="nextDayBtnCal">â€º</button>
          </div>
        </div>
        <div class="timeline-content">
          <div class="timeline-time-col">
            ${Array.from({length:hoursVisible},(_,i)=>{
              const hour = startHour + i;
              const isCurrent = hour === Math.floor(currentTime/60);
              return `<div class="timeline-time-label ${isCurrent?'current':''}" style="top:${i*100}px;">
                <span>${formatTime(hour)}</span>
                <div class="timeline-time-tick"></div>
              </div>`;
            }).join('')}
          </div>
          <div class="timeline-task-col" id="timelineTaskCol" style="min-height:${timelineHeight}px;">
            ${Array.from({length:hoursVisible},(_,i)=>{
              const hour = startHour + i;
              return `<div class="timeline-hour-line" style="top:${i*100}px;"></div>
                ${i < hoursVisible - 1 ? `<div class="timeline-hour-line half" style="top:${i*100+50}px;"></div>` : ''}`;
            }).join('')}
            ${tasks.map(t=>{
              const top = minutesToPixels(t.startTime - startHour*60);
              const height = minutesToPixels(t.duration);
              const durationText = t.duration >= 60 ? `${Math.floor(t.duration/60)}h ${t.duration%60}m` : `${t.duration}m`;
              return `<div class="timeline-task-block ${t.category}" data-task-id="${t.id}" data-start="${t.startTime}" data-duration="${t.duration}" style="top:${top}px; height:${height}px;">
                <div class="timeline-task-strip"></div>
                <div class="timeline-task-title">${t.title}</div>
                ${height > 60 ? `<div class="timeline-task-duration">${durationText}</div>` : ''}
              </div>`;
            }).join('')}
            <div class="timeline-current-time" id="timelineCurrentTime" style="top:${minutesToPixels(currentTime - startHour*60)}px;"></div>
          </div>
        </div>
        <div class="bottom-tab-bar">
          <button class="tab-btn" data-tab="tasks" data-mode="${mode}" data-energy="${energy}">
            <span class="tab-icon">ðŸ“‹</span>
            <span class="tab-label">Tasks</span>
          </button>
          <button class="tab-btn" data-tab="mood" data-mode="${mode}" data-energy="${energy}">
            <span class="tab-icon">ðŸŽ­</span>
            <span class="tab-label">Mood</span>
          </button>
          <button class="tab-btn" data-tab="tips" data-mode="${mode}" data-energy="${energy}">
            <span class="tab-icon">ðŸ’¡</span>
            <span class="tab-label">Tips</span>
          </button>
          <button class="tab-btn" data-tab="profile">
            <span class="tab-icon">ðŸ‘¤</span>
            <span class="tab-label">Profile</span>
          </button>
        </div>
      </div>`;
      // Handle view tab buttons
      const listViewBtn = c.querySelector('#listViewBtn');
      if(listViewBtn) {
        listViewBtn.onclick = () => {
          const content = c.querySelector('.timeline-content');
          if (content) {
            content.style.opacity = '0';
            setTimeout(() => {
              scrollToTop(true);
              showTaskRecommendations(mode, energy, '');
            }, 180);
          } else {
            showTaskRecommendations(mode, energy, '');
          }
        };
      }
      
      // Handle day selector buttons
      const prevDayBtnCal = c.querySelector('#prevDayBtnCal');
      const nextDayBtnCal = c.querySelector('#nextDayBtnCal');
      if (prevDayBtnCal) prevDayBtnCal.onclick = () => alert('Previous day feature coming soon');
      if (nextDayBtnCal) nextDayBtnCal.onclick = () => alert('Next day feature coming soon');
      // Update current time indicator every minute
      const updateCurrentTime = () => {
        const now = new Date();
        const pos = minutesToPixels(getCurrentTimePosition() - startHour*60);
        const indicator = c.querySelector('#timelineCurrentTime');
        if(indicator) {
          indicator.style.top = pos + 'px';
          indicator.style.transition = 'top 1s linear';
        }
      };
      updateCurrentTime();
      const timeInterval = setInterval(updateCurrentTime, 60000);
      // Store interval for cleanup (would need to be managed properly in real app)
      
      // Basic drag functionality (simplified)
      let dragging = null;
      let dragOffset = 0;
      c.querySelectorAll('.timeline-task-block').forEach(block=>{
        block.addEventListener('mousedown', startDrag);
        block.addEventListener('touchstart', startDrag);
      });
      function startDrag(e) {
        e.preventDefault();
        e.stopPropagation();
        dragging = e.target.closest('.timeline-task-block');
        if(!dragging) return;
        dragging.classList.add('dragging');
        const touch = e.touches ? e.touches[0] : e;
        const rect = dragging.getBoundingClientRect();
        const col = c.querySelector('#timelineTaskCol');
        const colRect = col.getBoundingClientRect();
        dragOffset = touch.clientY - rect.top;
        const currentTop = parseInt(dragging.style.top) || 0;
        dragging.style.position = 'fixed';
        dragging.style.zIndex = '100';
        dragging.style.width = rect.width + 'px';
        dragging.style.left = colRect.left + 8 + 'px';
        dragging.style.top = (colRect.top + currentTop) + 'px';
        window.addEventListener('mousemove', onDrag);
        window.addEventListener('mouseup', endDrag);
        window.addEventListener('touchmove', onDrag);
        window.addEventListener('touchend', endDrag);
      }
      function onDrag(e) {
        if(!dragging) return;
        e.preventDefault();
        const touch = e.touches ? e.touches[0] : e;
        const col = c.querySelector('#timelineTaskCol');
        const colRect = col.getBoundingClientRect();
        const newFixedTop = touch.clientY - dragOffset;
        dragging.style.top = newFixedTop + 'px';
        // Calculate relative position for snapping
        let relativeTop = newFixedTop - colRect.top;
        relativeTop = Math.max(0, Math.min(relativeTop, timelineHeight - parseInt(dragging.dataset.duration || 0) / 60 * 100));
        const snappedRelative = Math.round(relativeTop / 25) * 25; // Snap to 15min increments (25px = 15min)
        dragging.style.top = (colRect.top + snappedRelative) + 'px';
      }
      function endDrag() {
        if(!dragging) return;
        const col = c.querySelector('#timelineTaskCol');
        const colRect = col.getBoundingClientRect();
        const fixedTop = parseInt(dragging.style.top) || 0;
        const relativeTop = fixedTop - colRect.top;
        const snappedTop = Math.round(relativeTop / 25) * 25;
        const newMinutes = Math.round((snappedTop / 100) * 60) + startHour*60;
        dragging.dataset.start = newMinutes;
        dragging.classList.remove('dragging');
        dragging.style.position = 'absolute';
        dragging.style.zIndex = '20';
        dragging.style.left = '';
        dragging.style.width = '';
        dragging.style.top = snappedTop + 'px';
        // Update stats
        const statsEl = c.querySelector('#timelineStats');
        if(statsEl) {
          const taskBlocks = c.querySelectorAll('.timeline-task-block:not(.completed)');
          const totalMinutes = Array.from(taskBlocks).reduce((sum,block)=>{
            return sum + parseInt(block.dataset.duration || 0);
          }, 0);
          const totalHours = Math.round(totalMinutes / 60);
          statsEl.textContent = `${taskBlocks.length} tasks â€¢ ${totalHours}h planned`;
        }
        window.removeEventListener('mousemove', onDrag);
        window.removeEventListener('mouseup', endDrag);
        window.removeEventListener('touchmove', onDrag);
        window.removeEventListener('touchend', endDrag);
        dragging = null;
      }
      
      // Task block click handler
      c.querySelectorAll('.timeline-task-block').forEach(block=>{
        block.addEventListener('click',(e)=>{
          if(dragging) return;
          const title = block.querySelector('.timeline-task-title').textContent;
          alert(`Task: ${title}\n\nFeature: Task details and rescheduling coming soon!`);
        });
      });
      
      // Handle tab navigation
      c.querySelectorAll('.tab-btn').forEach(btn=>{
        btn.onclick = () => {
          const tab = btn.dataset.tab;
          const tabMode = btn.dataset.mode || mode;
          const tabEnergy = btn.dataset.energy || energy;
          if(tab === 'tasks') showTaskRecommendations(tabMode, tabEnergy, '');
          else if(tab === 'mood') showMoodScreen(tabMode, tabEnergy);
          else if(tab === 'tips') showTipsScreen(tabMode, tabEnergy);
          else if(tab === 'profile') showProfileScreen();
        };
      });
    }
    // -------- App starts at check-in ---------
    renderCheckin();
  </script>
</body>
</html>
