<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Daily Check-In ‚Äì AI Planner</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,600,700&display=swap">
  <style>
    :root {
      --iphone-width: 393px;
      --iphone-height: 852px;
      --max-safe-top: calc(env(safe-area-inset-top, 0px) + 44px);
      --max-safe-bottom: calc(env(safe-area-inset-bottom, 0px) + 34px);
      --gradient-bg: linear-gradient(137deg, #1a1f4d 0%, #252a5d 100%);
      --card-bg: rgba(45,53,88,0.95);
      --card-border: rgba(255,255,255,0.10);
      --accent-yellow: #f4e87c;
      --accent-coral: #ffb4a8;
      --accent-blue: #89cff0;
      --progress-gray: rgba(74, 79, 107, 0.4);
      --danger: #ff9f43;
      --shadow-card: 0 4px 12px rgba(0,0,0,0.15);
      --shadow-btn: 0 4px 12px rgba(244,232,124,0.3);
      --shadow-btn-active: 0 6px 16px rgba(244,232,124,0.40);
      --text-primary: #fff;
      --text-secondary: #b8bcc9;
      --text-on-yellow: #1a1f4d;
      --gray: #4a4f6b;
      --radius-card: 16px;
      --radius-btn: 26px;
      --font-title: clamp(22px, 4.5vw, 26px);
      --font-question: clamp(17px, 4vw, 19px);
      --font-label: clamp(13px, 3vw, 15px);
      --font-btn: clamp(15px, 3.7vw, 17px);
      --font-value: 14px;
      --font-answer-label: 11px;
      --font-cardind: 12px;
      --transition: cubic-bezier(.22,1,.36,1);
    }
    html {
      background: var(--gradient-bg);
      height: 100%;
      min-height: 100%;
    }
    body {
      min-height: 100vh;
      height: 100vh;
      background: var(--gradient-bg);
      margin: 0;
      color: var(--text-primary);
      font-family: 'Inter', 'SF Pro Display', Arial, sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      position: relative;
    }
    .safe-area {
      width: 100vw;
      max-width: var(--iphone-width);
      min-height: 100vh;
      min-height: 100svh;
      height: 100vh;
      position: relative;
      box-sizing: border-box;
      padding-bottom: max(env(safe-area-inset-bottom, 0px), 20px);
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      background: none;
      overflow-x: hidden;
      justify-content: flex-start;
    }
    .status-bar {
      height: 44px;
      width: 100%;
      display: flex;
      align-items: flex-end;
      background: transparent;
      padding: 0 0 4px 0;
      color: #fafafa;
      font-size: 14px;
      letter-spacing: 3px;
      user-select: none;
      padding-top: env(safe-area-inset-top, 0px);
      margin-bottom: 0;
    }
    .header {
      min-height: 72px;
      height: clamp(72px, 13vw, 82px);
      display: flex;
      align-items: flex-end;
      background: transparent;
      margin-top: 0;
      margin-bottom: 8px;
      position: relative;
      padding-left: 16px;
      justify-content: center;
    }
    .header .back-btn {
      position: absolute;
      left: 0; bottom: 12px;
      width: 44px; height: 44px;
      min-width: 44px; min-height: 44px;
      background: none; border: none;
      color: var(--text-secondary);
      font-size: 24px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      border-radius: 50%;
      outline: none;
      z-index: 10;
    }
    .header .back-btn:active { color: #f4e87c; background: rgba(244,232,124,0.07); }
    .title {
      color: var(--text-primary);
      font-size: var(--font-title);
      font-weight: 600;
      letter-spacing: 0.5px;
      text-align: center;
      width: 100%;
      margin-bottom: 3px;
    }
    .progress {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 16px;
      height: 32px;
      width: 100%;
      z-index: 2;
    }
    .prog-dot, .prog-dot.past, .prog-dot.current, .prog-dot.skip {
      width: 8px; height: 8px;
      min-width: 8px; min-height: 8px;
      border-radius: 50%;
      margin: 0 6px;
      background: var(--progress-gray);
      display: flex; align-items: center; justify-content: center;
      position: relative;
      transition: background 0.18s, box-shadow 0.18s, transform 0.18s;
    }
    .prog-dot.current {
      background: var(--accent-yellow);
      box-shadow: 0 0 8px 3px #f4e87c88;
      transform: scale(1.2);
      animation: growDot 0.20s;
    }
    .prog-dot.past {
      background: var(--accent-yellow);
    }
    .prog-dot.past:after {
      content: '\2713';
      font-size: 7px;
      color: #252a5d;
      position: absolute;
      left: 1px; top: -1px;
      font-weight: 700;
    }
    .prog-dot.skip {
      background: var(--progress-gray);
    }
    .prog-dot.skip:after {
      content: '\23ed';
      font-size: 7px;
      color: #ffd54f;
      position: absolute;
      left: 1px; top: -2px;
      font-weight: 700;
    }
    @keyframes growDot {
      0% { transform: scale(0.8); box-shadow: none; }
      100% { transform: scale(1.2); box-shadow: 0 0 10px var(--accent-yellow, #f4e87c77); }
    }
    .card-slide-ctn {
      height: clamp(435px, 48vh, 520px);
      min-height: 360px;
      max-height: 520px;
      position: relative;
      overflow: hidden;
      margin-bottom: 8px;
      flex-shrink: 1;
      flex-grow: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .glass-card {
      width: min(100% - 32px, 361px);
      margin: 0 auto;
      min-height: 360px; max-height: 500px;
      background: var(--card-bg);
      border-radius: var(--radius-card);
      box-shadow: var(--shadow-card);
      border: 1px solid var(--card-border);
      padding: 24px;
      margin-bottom: 16px;
      margin-top: 0px;
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      position: absolute;
      left: 0;
      right: 0;
      transition: transform 0.22s var(--transition), opacity 0.21s var(--transition);
      opacity: 1;
      z-index: 10;
      box-sizing: border-box;
    }
    .glass-card.next { transform: translateX(60%); opacity: 0; z-index: 1; pointer-events: none; }
    .glass-card.prev { transform: translateX(-60%); opacity: 0; z-index: 1; pointer-events: none; }
    .glass-card.active { transform: translateX(0px); opacity: 1; z-index: 10; }
    .glass-card.leaving { transition: transform 0.13s var(--transition), opacity 0.13s var(--transition); }
    .glass-card.entering { transition: transform 0.22s var(--transition), opacity 0.22s var(--transition); }
    .glass-card.final {
      min-height: 300px;
      justify-content: center;
      align-items: center;
      text-align: center;
      background: linear-gradient(120deg, #f4e87c22, #2d3558EE 70%);
    }
    /* CARD CONTENT */
    .card-indicator {
      text-transform: uppercase;
      font-size: var(--font-cardind);
      letter-spacing: 1.2px;
      color: var(--text-secondary);
      font-weight: 600;
      margin-bottom: 8px;
    }
    .question-txt {
      font-size: var(--font-question);
      color: var(--text-primary);
      font-weight: 500;
      margin-bottom: 8px;
      line-height: 1.4;
      text-align: left;
    }
    .subtext-txt {
      font-size: var(--font-label);
      color: var(--text-secondary);
      margin-bottom: 24px;
      line-height: 1.2;
      min-height: 14px;
      text-align: left;
    }
    /* EMOJI SCALE */
    .emoji-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      margin-top: 36px;
      margin-bottom: 20px;
      width: 100%;
      position: relative;
    }
    .scale-bar {
      position: absolute;
      top:28px; left:0; right:0;
      height: 2px;
      width: 100%;
      z-index: 0;
      background: repeating-linear-gradient(90deg, rgba(200,200,200,0.1) 0 6px, transparent 6px 18px);
    }
    .scale-gradient {
      position: absolute; top:28px; left:0; right:0;
      height: 2px; width: 100%; border-radius: 2px;
      background: linear-gradient(90deg,#ff6961,#f4e87c 50%,#b8f755 100%);
      opacity: 0.65;
      z-index: 1;
    }
    .emoji-btn {
      background: none;
      border: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      outline: none;
      cursor: pointer;
      padding: 0;
      margin: 0 3px;
      transition: opacity 0.16s, transform 0.19s;
      opacity: 0.6;
      width: 56px;
      height: 56px;
      border-radius: 28px;
      position: relative;
      z-index: 2;
    }
    .emoji-btn.selected,
    .emoji-btn:focus,
    .emoji-btn:active,
    .emoji-btn:hover {
      opacity: 1;
      transform: scale(1.15);
      box-shadow: 0 0 0 5px #f4e87c77, 0 4px 12px rgba(244,232,124,0.13);
      background: rgba(244,232,124,0.08);
    }
    .emoji-icn {
      font-size: 44px;
      margin-top: 0;
      transition: transform 0.15s;
      pointer-events: none;
    }
    .emoji-label {
      font-size: var(--font-answer-label);
      color: var(--text-secondary);
      font-weight: 400;
      margin-top: 8px;
      text-align: center;
      width: 60px;
      margin-left: -2px;
      letter-spacing: 0.1px;
      user-select: none;
    }
    /* BINARY CARDS */
    .binary-choices {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 20px;
    }
    .choice-card {
      display: flex;
      flex-direction: row;
      align-items: center;
      width: 100%;
      min-height: 120px;
      padding: 20px;
      border-radius: 12px;
      background: #252a5d;
      border: 2px solid transparent;
      box-shadow: 0 2px 4px rgba(0,0,0, 0.1);
      transition: border 0.18s, background 0.15s, box-shadow 0.16s, opacity .15s;
      cursor: pointer;
      opacity: 0.85;
      position: relative;
    }
    .choice-card.selected {
      border: 2px solid var(--choice-color, #ffb4a8);
      background: linear-gradient(100deg, var(--choice-color, #ffb4a8)22%, transparent 120%);
      box-shadow: 0 0 18px 3px var(--choice-color-weak, #ffb4a829);
      opacity: 1;
    }
    .choice-card.selected:after {
      content: '\2713';
      position: absolute;
      top: 12px; right: 12px;
      width: 20px; height: 20px;
      background: #fff;
      color: var(--choice-color, #ffb4a8);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 13px;
      font-weight: bold;
      box-shadow: 0 1px 3px #0009;
      z-index: 5;
      border: 2px solid #fff;
    }
    .choice-card:not(.selected):hover, .choice-card:not(.selected):active {
      opacity: 1;
      background: #2d3558;
      border: 2px solid rgba(255,255,255,0.1);
    }
    .choice-card:not(.selected) { transition: opacity 0.16s, border 0.1s; }
    .choice-card.faded { opacity: 0.5; }
    .choice-card .choice-icon {
      width: 56px; height: 56px;
      background: var(--choice-color-weak, #ffb4a814);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      margin-right: 16px;
      font-size: 38px;
      color: var(--choice-color, #ffb4a8);
      flex-shrink: 0;
    }
    .choice-card .choice-content { flex: 1; display: flex; flex-direction: column; justify-content: center; }
    .choice-label {
      color: #fff;
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .choice-desc {
      color: #b8bcc9;
      font-size: 14px;
      font-weight: 400;
      line-height: 1.4;
    }
    /* SLIDER CARD */
    .slider-ctn {
      width: 100%;
      margin-top: 56px;
      margin-bottom: 18px;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }
    .energy-slider {
      width: calc(100% - 48px);
      max-width: 300px;
      height: 6px;
      border-radius: 3px;
      background: #3a3f5a;
      position: relative;
      margin: 0 auto;
      box-shadow: 0 1px 2px rgba(0,0,0,0.2) inset;
      overflow: visible;
      z-index: 2;
    }
    .slider-fill {
      height: 6px;
      border-radius: 3px;
      position: absolute;
      left: 0; top: 0;
      background: linear-gradient(90deg,#f4e87c,#ffb366 120%);
      pointer-events: none;
      transition: width 0.09s cubic-bezier(.18,.72,.42,1);
    }
    .slider-ticks { position:absolute; left:0;top:0;right:0;height:20px;z-index:3; pointer-events: none; }
    .slider-tick {
      position: absolute;
      width: 2px; height: 8px;
      background: var(--progress-gray);
      border-radius: 2px;
      top: -7px;
    }
    .slider-thumb {
      width: 32px; height: 32px;
      border-radius: 50%;
      background: linear-gradient(180deg,#fff 75%,#ede9c1 100%);
      border: 2px solid #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
      position: absolute;
      left: 0; top: 50%;
      transform: translate(-16px,-50%) scale(1);
      cursor: grab;
      transition: box-shadow 0.17s, background 0.17s, border 0.14s, transform .16s;
      z-index: 5;
      display: flex; align-items: center; justify-content: center;
    }
    .slider-thumb:active {
      box-shadow: 0 4px 10px rgba(0,0,0,0.34);
      background: linear-gradient(180deg,#fff 60%,#f9f6eb 100%);
      border-width: 2px;
      transform: translate(-16px,-50%) scale(1.12);
    }
    .slider-value-badge {
      position: absolute;
      left: 50%;
      top: -36px;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.80);
      color: #1a1f4d;
      border-radius: 12px;
      min-width: 40px;
      height: 24px;
      font-size: 14px;
      font-weight: 600;
      display: flex; align-items: center; justify-content: center;
      pointer-events: none;
      transition: opacity 0.18s, top 0.22s;
      opacity: 0;
      z-index: 20;
      padding: 0 8px;
      box-sizing: border-box;
    }
    .slider-value-badge.visible {
      opacity: 1;
      top: -38px;
    }
    .slider-labels {
      width: calc(100% - 48px);
      max-width: 300px;
      display: flex;
      justify-content: space-between;
      padding-top: 6px;
      font-size: 11px;
      color: #b8bcc9;
      font-weight: 400;
      user-select: none;
      margin-bottom: 0;
      letter-spacing: .1px;
    }
    /* BOTTOM NAV */
    .bottom-nav {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      width: 100vw;
      max-width: var(--iphone-width);
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 100px;
      padding: 0 24px;
      z-index: 100;
      background: none;
      padding-bottom: calc(12px + env(safe-area-inset-bottom, 0px));
    }
    .btn-skip {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: var(--font-btn);
      font-family: inherit;
      cursor: pointer;
      outline: none;
      padding: 0 18px;
      height: 44px; min-width: 60px;
      border-radius: 8px;
      transition: color 0.12s, text-decoration 0.2s;
      min-height: 44px;
    }
    .btn-skip:hover, .btn-skip:active { color: #9a9eab; text-decoration: underline; }
    .btn-continue {
      width: 140px; height: 52px;
      border-radius: var(--radius-btn);
      background: linear-gradient(90deg,#f4e87c,#ffd54f 80%);
      color: var(--text-on-yellow);
      font-size: var(--font-btn);
      font-weight: 600;
      border: none;
      outline: none;
      box-shadow: var(--shadow-btn);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: box-shadow 0.18s, background 0.18s, transform 0.09s, width 0.21s cubic-bezier(.22,1,.36,1);
      opacity: 0.4;
      pointer-events: none;
      gap: 9px;
      min-width: 90px; min-height: 44px;
    }
    .btn-continue.enabled {
      opacity: 1;
      pointer-events: auto;
    }
    .btn-continue:active { 
      background: linear-gradient(90deg,#f9edaf,#f4e87c); 
      transform: scale(0.98);
      box-shadow: var(--shadow-btn-active);
    }
    .btn-continue .spinner {
      display: inline-block; width:24px; height:24px; border:2.4px solid #fff3; border-radius:50%; border-top:2.4px solid #deca5d; animation: spin 1.1s linear infinite; box-sizing: border-box; }
    @keyframes spin { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }
    @media (max-width: 395px) {
      .safe-area,.bottom-nav { width: 100vw !important; max-width: 100vw; }
      .glass-card { width: calc(100vw - 18px);}
      .bottom-nav { padding-left: 6px; padding-right: 6px; }
    }
    @media (max-height:770px){ .card-slide-ctn { height: 86vw; } }
    @media (max-width: 320px) {
      .glass-card { min-height: 260px; padding: 12px; }
      .status-bar, .header { min-height: 40px; }
      .progress { margin-bottom:10px; }
      .success-anim { width: 68px; height: 68px; font-size: 34px; }
    }
    /* SUCCESS ANIMATION */
    .success-anim {
      width: 104px; height:104px; border-radius:40px; margin:30px auto 6px; background:linear-gradient(137deg,#f4e87c 65%, #ffd54f 100%); box-shadow: 0 4px 24px #ffe45b77;
      display: flex; align-items: center; justify-content: center;
      position: relative;
      font-size: 60px;
      color: #1a1f4d;
      animation: popIn 0.5s cubic-bezier(.19,.72,.42,1.32);
      opacity: 0.98;
    }
    @keyframes popIn {
      0% {transform:scale(0.6);opacity:0;}
      80%{transform:scale(1.14);}
      100% {transform:scale(1);opacity:0.98;}
    }
    .success-anim .checkmark{
      font-size: 50px; color: #1a1f4d;
    }
    .success-title {
      color: #f4e87c;
      font-size: 22px;
      margin-top: 10px;
      margin-bottom:8px;
      font-weight: 700;
    }
    .success-desc {
      color: #fff;
      font-size: 17px;
      margin-bottom: 18px;
      font-weight: 400;
    }
    .success-btn {
      width: 180px; height: 52px;
      margin-top: 14px;
      font-size: 16px;
      font-weight: 600;
      background: linear-gradient(90deg,#f4e87c,#ffd54f 85%);
      color: var(--text-on-yellow);
      border-radius: 26px;
      box-shadow: 0 4px 12px rgba(244,232,124,0.30);
      border: none;
      cursor: pointer;
      transition: box-shadow .14s, background .16s, transform .11s;
      min-width: 100px; min-height: 44px;
    }
    .success-btn:active {background:linear-gradient(90deg,#f9edaf,#f4e87c);transform:scale(.98);box-shadow:0 8px 18px #ffe4a2a9;}
    .home-indicator {
      position: fixed; bottom: 8px; left: 50%; transform:translateX(-50%);
      width: 120px; height: 5px; border-radius: 3px; background: #232649bb;
      opacity: 0.93;
      z-index: 201;
      pointer-events:none;
    }
  </style>
</head>
<body>
  <div class="safe-area">
    <div class="status-bar">9:41</div>
    <div class="header">
      <button class="back-btn" id="backBtn" aria-label="Back" style="visibility:hidden">&#8592;</button>
      <span class="title" id="screenTitle">Daily Check-in</span>
    </div>
    <div class="progress" id="progressDots"></div>
    <div class="card-slide-ctn" id="cardCtn"></div>
    <div class="bottom-nav">
      <button class="btn-skip" id="skipBtn">Skip</button>
      <button class="btn-continue" id="continueBtn"><span id="continueBtnText">Continue &rarr;</span></button>
    </div>
    <div class="home-indicator"></div>
  </div>
  <script>
    // ------ QUESTIONS DATA (per your spec) ------
    const questions = [
      {
        type:'emoji',
        id:"mental_energy",
        indicator: 'Question 1 of 4',
        question: "How's your mental energy right now?",
        subtext: 'Be honest ‚Äì this helps us find the right tasks for you',
        answers: [
          {emoji:'üò´', label:'Drained'},
          {emoji:'üò¥', label:'Low'},
          {emoji:'üòê', label:'Okay'},
          {emoji:'üôÇ', label:'Good'},
          {emoji:'ü§©', label:'Peak'}
        ]
      },
      {
        type:'binary',
        id:'mode',
        indicator: 'Question 2 of 4',
        question:'Which sounds more appealing right now?',
        answers: [
          {icon:'üé®', color:'#ffb4a8', label:'Creative Mode', desc: 'Brainstorming, ideation, and exploration'},
          {icon:'üéØ', color:'#89cff0', label:'Focused Mode', desc: 'Execution, analysis, and completion'}
        ]
      },
      {
        type:'slider',
        id:'physical_energy',
        indicator: 'Question 3 of 4',
        question: "How's your physical energy?",
        subtext:'Consider your body ‚Äì restless, tired, or ready to move?',
        minLabel:'Low', maxLabel:'High',
        min:0, max:100, step:1,
        initial:50
      },
      {
        type:'emoji',
        id:"clarity",
        indicator: 'Question 4 of 4',
        question: "How clear is your thinking?",
        answers: [
          {emoji:'üòµ\u200düí´', label:'Foggy'},
          {emoji:'üòï', label:'Low'},
          {emoji:'üòê', label:'Okay'},
          {emoji:'üôÇ', label:'Good'},
          {emoji:'ü§ì', label:'Sharp'}
        ]
      }
    ];

    // State
    let qIdx = 0;
    let answers = [null, null, null, null];
    let skipStates = [false, false, false, false];
    let leaving = false;
    let animDir = 1; // 1: next/forward, -1: prev/back

    const progressDots = document.getElementById('progressDots');
    const cardCtn = document.getElementById('cardCtn');
    const backBtn = document.getElementById('backBtn');
    const skipBtn = document.getElementById('skipBtn');
    const continueBtn = document.getElementById('continueBtn');
    const continueBtnText = document.getElementById('continueBtnText');
    const screenTitle = document.getElementById('screenTitle');

    function renderProgress() {
      progressDots.innerHTML = '';
      for (let i = 0; i < questions.length; i++) {
        let dot = document.createElement('div');
        dot.className = 'prog-dot';
        if (i < qIdx) {
          if(skipStates[i]) dot.classList.add('skip');
          else dot.classList.add('past');
        } else if(i === qIdx) {
          dot.classList.add('current');
        }
        progressDots.appendChild(dot);
      }
    }

    function buildEmojiScale(q, value) {
      const row = document.createElement('div');
      row.className = 'emoji-row';
      row.innerHTML = `<div class='scale-bar'></div><div class='scale-gradient'></div>`;
      q.answers.forEach((ans, i) => {
        const btn = document.createElement('button');
        btn.className = 'emoji-btn';
        btn.setAttribute('tabindex', '0');
        btn.setAttribute('aria-label', ans.label);
        btn.innerHTML = `<span class='emoji-icn'>${ans.emoji}</span><div class='emoji-label'>${ans.label}</div>`;
        if (value === i) btn.classList.add('selected');
        btn.addEventListener('click', () => {
          answers[qIdx] = i;
          renderMain();
        });
        btn.addEventListener('keydown', e => {
          if(["Enter"," "].includes(e.key)) btn.click();
        });
        row.appendChild(btn);
      });
      return row;
    }
    function buildBinaryChoices(q, value) {
      const wrap = document.createElement('div');
      wrap.className = 'binary-choices';
      q.answers.forEach((ans, i) => {
        const card = document.createElement('div');
        card.className = 'choice-card';
        card.style.setProperty('--choice-color', ans.color);
        card.style.setProperty('--choice-color-weak', ans.color+"19");
        if(value === i) card.classList.add('selected');
        if(value !== null && value !== i) card.classList.add('faded');
        card.setAttribute('tabindex','0');
        card.setAttribute('aria-label', ans.label+", "+ans.desc);
        card.innerHTML = `<span class='choice-icon'>${ans.icon}</span><div class='choice-content'><span class='choice-label'>${ans.label}</span><span class='choice-desc'>${ans.desc}</span></div>`;
        card.addEventListener('click', () => {
          answers[qIdx] = i;
          renderMain();
        });
        card.addEventListener('keydown', e => {
          if(["Enter"," "].includes(e.key)) card.click();
        });
        wrap.appendChild(card);
      });
      return wrap;
    }
    function buildSliderInput(q, value) {
      const wrap = document.createElement('div');
      wrap.className = 'slider-ctn';
      if (value === null) value = q.initial || 50;

      // value badge
      const badge = document.createElement('div');
      badge.className = 'slider-value-badge';
      badge.textContent = value + '%';
      wrap.appendChild(badge);

      // slider track
      const slider = document.createElement('div');
      slider.className = 'energy-slider';
      const fill = document.createElement('div');
      fill.className = 'slider-fill';
      slider.appendChild(fill);
      // ticks
      const ticks = document.createElement('div');
      ticks.className = 'slider-ticks';
      [0.25,0.5,0.75].forEach(frac => {
        const t = document.createElement('div');
        t.className = 'slider-tick';
        t.style.left = (frac*100)+"%";
        ticks.appendChild(t);
      });
      slider.appendChild(ticks);
      wrap.appendChild(slider);
      // thumb
      const thumb = document.createElement('div');
      thumb.className = 'slider-thumb';
      thumb.setAttribute('tabindex','0');
      thumb.setAttribute('role','slider');
      thumb.setAttribute('aria-valuenow', value);
      thumb.setAttribute('aria-valuemin',q.min);
      thumb.setAttribute('aria-valuemax',q.max);
      slider.appendChild(thumb);
      // labels
      const labels = document.createElement('div');
      labels.className = 'slider-labels';
      labels.innerHTML = `<span>${q.minLabel||q.min}</span><span>${q.maxLabel||q.max}</span>`;
      wrap.appendChild(labels);

      // Airy spacing
      function setPos(val) {
        let pct = Math.round((val-q.min)/(q.max-q.min)*100);
        fill.style.width = pct + '%';
        let range = slider.offsetWidth-32;
        let px = Math.max(0, Math.min(range, Math.round(pct/100*range)));
        thumb.style.left = px+'px';
        badge.textContent = val+'%';
        answers[qIdx] = val;
      }
      setTimeout(()=>setPos(value),30);
      
      // Show badge on interaction
      let dragging = false;
      thumb.addEventListener('mousedown',start);
      thumb.addEventListener('touchstart',start);
      function start(e) {
        dragging = true;
        badge.classList.add('visible');
        document.body.style.userSelect='none';
        move(e);
        window.addEventListener('mousemove', move);
        window.addEventListener('mouseup', up);
        window.addEventListener('touchmove', move);
        window.addEventListener('touchend', up);
      }
      function move(e) {
        if(!dragging) return;
        let x = (e.touches ? e.touches[0].clientX : e.clientX) - slider.getBoundingClientRect().left;
        let pct = Math.min(1, Math.max(0, (x-16)/(slider.offsetWidth-32)) );
        let value = Math.round(pct * (q.max-q.min) + q.min);
        setPos(value);
      }
      function up() {
        dragging = false;
        badge.classList.remove('visible');
        document.body.style.userSelect='';
        window.removeEventListener('mousemove', move);
        window.removeEventListener('mouseup', up);
        window.removeEventListener('touchmove', move);
        window.removeEventListener('touchend', up);
        renderMain();
      }
      thumb.addEventListener('keydown', e => {
        let val = answers[qIdx]||q.initial||50;
        if(e.key==="ArrowLeft" || e.key==="ArrowDown") { val = Math.max(val-5,q.min); setPos(val); }
        if(e.key==="ArrowRight" || e.key==="ArrowUp") { val = Math.min(val+5,q.max); setPos(val); }
        if(["Enter"," "].includes(e.key)) up();
      });
      return wrap;
    }
    function cardOutClass(dir) {return dir>0? 'leaving prev':'leaving next'}
    function cardInClass(dir) {return dir>0? 'entering active':'active entering';}

    function renderMain() {
      renderProgress();
      // Handle card
      cardCtn.innerHTML = '';
      let show = qIdx;
      // Animate out/in
      let prevCard = document.querySelector('.glass-card.active');
      if(prevCard) {
        prevCard.classList.remove('active','entering');
        prevCard.classList.add('leaving', animDir>0?'prev':'next');
      }
      setTimeout(()=>{
        cardCtn.innerHTML = '';
        // Build card
        let c = document.createElement('div');
        c.className = 'glass-card active';
        const q = questions[show];
        c.innerHTML = `<div class='card-indicator'>${q.indicator||''}</div>`+
          `<div class='question-txt'>${q.question}</div>`+
          `<div class='subtext-txt'>${q.subtext||''}</div>`;
        // Render input type
        let ansVal = answers[show];
        if(q.type==='emoji') c.appendChild(buildEmojiScale(q, ansVal));
        if(q.type==='binary') c.appendChild(buildBinaryChoices(q, ansVal));
        if(q.type==='slider') c.appendChild(buildSliderInput(q, ansVal));
        cardCtn.appendChild(c);
        setTimeout(()=>{c.classList.add('active')},10);

        // Accessibility: update title and ARIA
        screenTitle.textContent = "Daily Check-in";
        c.setAttribute('aria-label', `${q.indicator}: ${q.question}`);
        c.setAttribute('tabindex','0');

        // CONTINUE button UI
        let ready = ansVal !== null && ansVal !== undefined;
        // Last question: swap button text
        if(qIdx===questions.length-1) {
          continueBtnText.textContent = 'Get My Recommendations';
          continueBtn.style.width = '180px';
        } else {
          continueBtnText.textContent = 'Continue ‚Üí';
          continueBtn.style.width = '140px';
        }
        continueBtn.className = 'btn-continue'+(ready?' enabled':'');
        continueBtn.disabled = !ready;
        continueBtn.setAttribute('aria-disabled', (!ready).toString());
        // Skip Button: edge cases
        skipBtn.textContent = qIdx === 0 ? 'Skip intro' : 'Skip';
        skipBtn.style.visibility = ready ? 'visible' : 'visible';
        // Back button
        backBtn.style.visibility = qIdx>0 ? 'visible' : 'hidden';
      }, animDir? 140: 0);
    }
    function goTo(idx, dir) {
      if(idx < 0 || idx > questions.length) return;
      animDir = dir;
      if(idx === questions.length) {
        renderSuccessPage();
      } else {
        qIdx = idx;
        renderMain();
      }
    }
    continueBtn.addEventListener('click', () => {
      let ready = answers[qIdx]!==null && answers[qIdx]!==undefined;
      if(!ready) return;
      // Animate loading, then advance
      continueBtnText.innerHTML = `<span class='spinner'></span>`;
      continueBtn.disabled = true;
      setTimeout(() => {
        continueBtn.disabled = false;
        goTo(qIdx+1,1);
      }, 600);
    });
    skipBtn.addEventListener('click', () => {
      skipStates[qIdx] = true;
      answers[qIdx]=null;
      goTo(qIdx+1,1);
    });
    backBtn.addEventListener('click',()=>{
      goTo(qIdx-1,-1);
    });
    // Initial render
    renderMain();

    // SUCCESS PAGE
    function renderSuccessPage() {
      progressDots.innerHTML = '';
      cardCtn.innerHTML = '';
      backBtn.style.visibility = 'hidden';
      skipBtn.style.visibility = 'hidden';
      continueBtn.style.display = 'none';
      let card = document.createElement('div');
      card.className = 'glass-card final';
      card.innerHTML = `<div class='success-anim'><span class='checkmark'>&#x2714;</span></div>
          <div class='success-title'>Well done!</div>
          <div class='success-desc'>Task recommendations are ready.<br>Based on your energy & focus, we'll suggest what's optimal next.</div>
          <button class='success-btn'>See My Tasks</button>`;
      cardCtn.appendChild(card);
      document.querySelector('.success-btn').addEventListener('click',()=>{
        card.innerHTML = `<div class='success-title' style='margin-top:100px;color:#fff;'>Thank you &#128075;<br><span style='font-size:18px;font-weight:400;'>You may close this window.</span></div>`
      });
    }

    // Accessibility: keyboard navigation for main card
    document.addEventListener('keydown', e=>{
      if(e.target.tagName==='INPUT' || e.target.tagName==='TEXTAREA') return;
      if(e.key==='ArrowRight' && continueBtn.classList.contains('enabled')) continueBtn.click();
      if(e.key==='ArrowLeft' && qIdx>0) backBtn.click();
      if(e.key==='ArrowUp') document.querySelector('.glass-card.active')?.focus();
    });
  </script>
</body>
</html>
